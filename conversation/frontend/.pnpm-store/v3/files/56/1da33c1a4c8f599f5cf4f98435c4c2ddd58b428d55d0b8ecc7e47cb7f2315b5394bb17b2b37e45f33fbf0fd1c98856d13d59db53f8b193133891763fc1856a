"use strict";var I=Object.defineProperty;var k=(i,e,t)=>e in i?I(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var l=(i,e,t)=>(k(i,typeof e!="symbol"?e+"":e,t),t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const ERROR_CODE={SUCCESS:"0000",UNKNOWN:"0010",NOT_INITIALIZED:"0020",NOT_SUPPORTED:"0030",APP_NOT_FOUND:"0040",AGENT_NOT_FOUND:"0050",TRANSPORT_ERROR:"0060",TIME_OUT:"0070",MALFORMED_DATA:"0080",NOT_LOGGED_IN:"0090"},APP$1={ADMIN:"admin",ARCHIVE:"archive",AUTH:"auth",CAS:"cas",COMMUNICATION:"communication",CONVERSATION:"conversation",DIRECTORY:"directory",USERBOOK:"userbook",INFRA:"infra",PORTAL:"portal",TIMELINE:"timeline",WORKSPACE:"workspace",EXPLORER:"explorer",VIDEO:"video",MINDMAP:"mindmap",SCRAPBOOK:"scrapbook",COLLABORATIVEWALL:"collaborativewall",WIKI:"wiki"},USER_PREFS={APPS:"apps",WIDGETS:"widgets",LANGUAGE:"language",AUTH_CONNECTOR_ACCESSED:"authenticatedConnectorsAccessed",CURSUS:"cursus",INFOTIP:"infotip",RGPD_COOKIES:"rgpdCookies"};class Subscription{constructor(e,t){l(this,"revoke");this._channel=e,this.revoke=this.setReceiver(s=>t==null?void 0:t(s.data))}setReceiver(e){var t;return(t=this._channel)==null||t.addEventListener("message",e),()=>{this._channel&&(this._channel.removeEventListener("message",e),this._channel.close(),delete this._channel)}}}class Subject{constructor(){l(this,"publishChannels",new Map)}getChannelName(e){return"Subject:"+e}getPublishChannel(e){const t=this.getChannelName(e);let s=this.publishChannels.get(t);return s||(s=this.newChannel(e),this.publishChannels.set(t,s)),s}newChannel(e){const t=this.getChannelName(e),s=new BroadcastChannel(t);return s.addEventListener("messageerror",r=>console.log(r.data)),s}publish(e,t){typeof e=="string"&&this.getPublishChannel(e).postMessage(t)}subscribe(e,t){if(typeof e=="string"){const s=this.newChannel(e);return new Subscription(s,t)}else return new Subscription}}const ASYNC_DATA_NAME={SESSION_READY:"sessionReady",LANG_READY:"langReady",SKIN_READY:"skinReady",OVERRIDE_READY:"overrideReady",APPCONF_READY:"appConfReady"};class Promisified{constructor(){l(this,"_resolution");l(this,"_rejection");l(this,"_promise",new Promise((e,t)=>{this._resolution=e,this._rejection=t}))}get promise(){return this._promise}resolve(e){this._resolution&&this._resolution(e)}reject(e){this._rejection&&this._rejection(e)}}class NotifyFramework{constructor(){l(this,"promises",{});l(this,"subject",new Subject)}asyncData(e){return typeof this.promises[e]>"u"&&(this.promises[e]=new Promisified),this.promises[e]}onSessionReady(){return this.asyncData(ASYNC_DATA_NAME.SESSION_READY)}onLangReady(){return this.asyncData(ASYNC_DATA_NAME.LANG_READY)}onSkinReady(){return this.asyncData(ASYNC_DATA_NAME.SKIN_READY)}onOverridesReady(){return this.asyncData(ASYNC_DATA_NAME.OVERRIDE_READY)}onAppConfReady(){return this.asyncData(ASYNC_DATA_NAME.APPCONF_READY)}promisify(){return new Promisified}events(){return this.subject}}const notify=new NotifyFramework;function bind(i,e){return function(){return i.apply(e,arguments)}}const{toString}=Object.prototype,{getPrototypeOf}=Object,kindOf=(i=>e=>{const t=toString.call(e);return i[t]||(i[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=i=>(i=i.toLowerCase(),e=>kindOf(e)===i),typeOfTest=i=>e=>typeof e===i,{isArray}=Array,isUndefined=typeOfTest("undefined");function isBuffer(i){return i!==null&&!isUndefined(i)&&i.constructor!==null&&!isUndefined(i.constructor)&&isFunction(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(i){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(i):e=i&&i.buffer&&isArrayBuffer(i.buffer),e}const isString=typeOfTest("string"),isFunction=typeOfTest("function"),isNumber=typeOfTest("number"),isObject=i=>i!==null&&typeof i=="object",isBoolean=i=>i===!0||i===!1,isPlainObject=i=>{if(kindOf(i)!=="object")return!1;const e=getPrototypeOf(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=i=>isObject(i)&&isFunction(i.pipe),isFormData=i=>{let e;return i&&(typeof FormData=="function"&&i instanceof FormData||isFunction(i.append)&&((e=kindOf(i))==="formdata"||e==="object"&&isFunction(i.toString)&&i.toString()==="[object FormData]"))},isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest),trim=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach(i,e,{allOwnKeys:t=!1}={}){if(i===null||typeof i>"u")return;let s,r;if(typeof i!="object"&&(i=[i]),isArray(i))for(s=0,r=i.length;s<r;s++)e.call(null,i[s],s,i);else{const n=t?Object.getOwnPropertyNames(i):Object.keys(i),o=n.length;let a;for(s=0;s<o;s++)a=n[s],e.call(null,i[a],a,i)}}function findKey(i,e){e=e.toLowerCase();const t=Object.keys(i);let s=t.length,r;for(;s-- >0;)if(r=t[s],e===r.toLowerCase())return r;return null}const _global=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),isContextDefined=i=>!isUndefined(i)&&i!==_global;function merge(){const{caseless:i}=isContextDefined(this)&&this||{},e={},t=(s,r)=>{const n=i&&findKey(e,r)||r;isPlainObject(e[n])&&isPlainObject(s)?e[n]=merge(e[n],s):isPlainObject(s)?e[n]=merge({},s):isArray(s)?e[n]=s.slice():e[n]=s};for(let s=0,r=arguments.length;s<r;s++)arguments[s]&&forEach(arguments[s],t);return e}const extend=(i,e,t,{allOwnKeys:s}={})=>(forEach(e,(r,n)=>{t&&isFunction(r)?i[n]=bind(r,t):i[n]=r},{allOwnKeys:s}),i),stripBOM=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),inherits=(i,e,t,s)=>{i.prototype=Object.create(e.prototype,s),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:e.prototype}),t&&Object.assign(i.prototype,t)},toFlatObject=(i,e,t,s)=>{let r,n,o;const a={};if(e=e||{},i==null)return e;do{for(r=Object.getOwnPropertyNames(i),n=r.length;n-- >0;)o=r[n],(!s||s(o,i,e))&&!a[o]&&(e[o]=i[o],a[o]=!0);i=t!==!1&&getPrototypeOf(i)}while(i&&(!t||t(i,e))&&i!==Object.prototype);return e},endsWith=(i,e,t)=>{i=String(i),(t===void 0||t>i.length)&&(t=i.length),t-=e.length;const s=i.indexOf(e,t);return s!==-1&&s===t},toArray=i=>{if(!i)return null;if(isArray(i))return i;let e=i.length;if(!isNumber(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=i[e];return t},isTypedArray=(i=>e=>i&&e instanceof i)(typeof Uint8Array<"u"&&getPrototypeOf(Uint8Array)),forEachEntry=(i,e)=>{const s=(i&&i[Symbol.iterator]).call(i);let r;for(;(r=s.next())&&!r.done;){const n=r.value;e.call(i,n[0],n[1])}},matchAll=(i,e)=>{let t;const s=[];for(;(t=i.exec(e))!==null;)s.push(t);return s},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,r){return s.toUpperCase()+r}),hasOwnProperty=(({hasOwnProperty:i})=>(e,t)=>i.call(e,t))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(i,e)=>{const t=Object.getOwnPropertyDescriptors(i),s={};forEach(t,(r,n)=>{let o;(o=e(r,n,i))!==!1&&(s[n]=o||r)}),Object.defineProperties(i,s)},freezeMethods=i=>{reduceDescriptors(i,(e,t)=>{if(isFunction(i)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=i[t];if(isFunction(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},toObjectSet=(i,e)=>{const t={},s=r=>{r.forEach(n=>{t[n]=!0})};return isArray(i)?s(i):s(String(i).split(e)),t},noop=()=>{},toFiniteNumber=(i,e)=>i!=null&&Number.isFinite(i=+i)?i:e,ALPHA="abcdefghijklmnopqrstuvwxyz",DIGIT="0123456789",ALPHABET={DIGIT,ALPHA,ALPHA_DIGIT:ALPHA+ALPHA.toUpperCase()+DIGIT},generateString=(i=16,e=ALPHABET.ALPHA_DIGIT)=>{let t="";const{length:s}=e;for(;i--;)t+=e[Math.random()*s|0];return t};function isSpecCompliantForm(i){return!!(i&&isFunction(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const toJSONObject=i=>{const e=new Array(10),t=(s,r)=>{if(isObject(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[r]=s;const n=isArray(s)?[]:{};return forEach(s,(o,a)=>{const h=t(o,r+1);!isUndefined(h)&&(n[a]=h)}),e[r]=void 0,n}}return s};return t(i,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=i=>i&&(isObject(i)||isFunction(i))&&isFunction(i.then)&&isFunction(i.catch),_setImmediate=((i,e)=>i?setImmediate:e?((t,s)=>(_global.addEventListener("message",({source:r,data:n})=>{r===_global&&n===t&&s.length&&s.shift()()},!1),r=>{s.push(r),_global.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",isFunction(_global.postMessage)),asap=typeof queueMicrotask<"u"?queueMicrotask.bind(_global):typeof process<"u"&&process.nextTick||_setImmediate,utils$1={isArray,isArrayBuffer,isBuffer,isFormData,isArrayBufferView,isString,isNumber,isBoolean,isObject,isPlainObject,isReadableStream,isRequest,isResponse,isHeaders,isUndefined,isDate,isFile,isBlob,isRegExp,isFunction,isStream,isURLSearchParams,isTypedArray,isFileList,forEach,merge,extend,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray,forEachEntry,matchAll,isHTMLForm,hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors,freezeMethods,toObjectSet,toCamelCase,noop,toFiniteNumber,findKey,global:_global,isContextDefined,ALPHABET,generateString,isSpecCompliantForm,toJSONObject,isAsyncFn,isThenable,setImmediate:_setImmediate,asap};function AxiosError(i,e,t,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),r&&(this.response=r,this.status=r.status?r.status:null)}utils$1.inherits(AxiosError,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$1.toJSONObject(this.config),code:this.code,status:this.status}}});const prototype$1=AxiosError.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{descriptors[i]={value:i}});Object.defineProperties(AxiosError,descriptors);Object.defineProperty(prototype$1,"isAxiosError",{value:!0});AxiosError.from=(i,e,t,s,r,n)=>{const o=Object.create(prototype$1);return utils$1.toFlatObject(i,o,function(h){return h!==Error.prototype},a=>a!=="isAxiosError"),AxiosError.call(o,i.message,e,t,s,r),o.cause=i,o.name=i.name,n&&Object.assign(o,n),o};const httpAdapter=null;function isVisitable(i){return utils$1.isPlainObject(i)||utils$1.isArray(i)}function removeBrackets(i){return utils$1.endsWith(i,"[]")?i.slice(0,-2):i}function renderKey(i,e,t){return i?i.concat(e).map(function(r,n){return r=removeBrackets(r),!t&&n?"["+r+"]":r}).join(t?".":""):e}function isFlatArray(i){return utils$1.isArray(i)&&!i.some(isVisitable)}const predicates=utils$1.toFlatObject(utils$1,{},null,function(e){return/^is[A-Z]/.test(e)});function toFormData(i,e,t){if(!utils$1.isObject(i))throw new TypeError("target must be an object");e=e||new FormData,t=utils$1.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,f){return!utils$1.isUndefined(f[g])});const s=t.metaTokens,r=t.visitor||u,n=t.dots,o=t.indexes,h=(t.Blob||typeof Blob<"u"&&Blob)&&utils$1.isSpecCompliantForm(e);if(!utils$1.isFunction(r))throw new TypeError("visitor must be a function");function c(p){if(p===null)return"";if(utils$1.isDate(p))return p.toISOString();if(!h&&utils$1.isBlob(p))throw new AxiosError("Blob is not supported. Use a Buffer instead.");return utils$1.isArrayBuffer(p)||utils$1.isTypedArray(p)?h&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function u(p,g,f){let A=p;if(p&&!f&&typeof p=="object"){if(utils$1.endsWith(g,"{}"))g=s?g:g.slice(0,-2),p=JSON.stringify(p);else if(utils$1.isArray(p)&&isFlatArray(p)||(utils$1.isFileList(p)||utils$1.endsWith(g,"[]"))&&(A=utils$1.toArray(p)))return g=removeBrackets(g),A.forEach(function(b,x){!(utils$1.isUndefined(b)||b===null)&&e.append(o===!0?renderKey([g],x,n):o===null?g:g+"[]",c(b))}),!1}return isVisitable(p)?!0:(e.append(renderKey(f,g,n),c(p)),!1)}const d=[],E=Object.assign(predicates,{defaultVisitor:u,convertValue:c,isVisitable});function m(p,g){if(!utils$1.isUndefined(p)){if(d.indexOf(p)!==-1)throw Error("Circular reference detected in "+g.join("."));d.push(p),utils$1.forEach(p,function(A,y){(!(utils$1.isUndefined(A)||A===null)&&r.call(e,A,utils$1.isString(y)?y.trim():y,g,E))===!0&&m(A,g?g.concat(y):[y])}),d.pop()}}if(!utils$1.isObject(i))throw new TypeError("data must be an object");return m(i),e}function encode$1(i){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function AxiosURLSearchParams(i,e){this._pairs=[],i&&toFormData(i,this,e)}const prototype=AxiosURLSearchParams.prototype;prototype.append=function(e,t){this._pairs.push([e,t])};prototype.toString=function(e){const t=e?function(s){return e.call(this,s,encode$1)}:encode$1;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function encode(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL(i,e,t){if(!e)return i;const s=t&&t.encode||encode;utils$1.isFunction(t)&&(t={serialize:t});const r=t&&t.serialize;let n;if(r?n=r(e,t):n=utils$1.isURLSearchParams(e)?e.toString():new AxiosURLSearchParams(e,t).toString(s),n){const o=i.indexOf("#");o!==-1&&(i=i.slice(0,o)),i+=(i.indexOf("?")===-1?"?":"&")+n}return i}class InterceptorManager{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){utils$1.forEach(this.handlers,function(s){s!==null&&e(s)})}}const InterceptorManager$1=InterceptorManager,transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1=typeof URLSearchParams<"u"?URLSearchParams:AxiosURLSearchParams,FormData$1=typeof FormData<"u"?FormData:null,Blob$1=typeof Blob<"u"?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv=typeof window<"u"&&typeof document<"u",_navigator=typeof navigator=="object"&&navigator||void 0,hasStandardBrowserEnv=hasBrowserEnv&&(!_navigator||["ReactNative","NativeScript","NS"].indexOf(_navigator.product)<0),hasStandardBrowserWebWorkerEnv=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),origin=hasBrowserEnv&&window.location.href||"http://localhost",utils=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv,hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv,navigator:_navigator,origin},Symbol.toStringTag,{value:"Module"})),platform={...utils,...platform$1};function toURLEncodedForm(i,e){return toFormData(i,new platform.classes.URLSearchParams,Object.assign({visitor:function(t,s,r,n){return platform.isNode&&utils$1.isBuffer(t)?(this.append(s,t.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},e))}function parsePropPath(i){return utils$1.matchAll(/\w+|\[(\w*)]/g,i).map(e=>e[0]==="[]"?"":e[1]||e[0])}function arrayToObject(i){const e={},t=Object.keys(i);let s;const r=t.length;let n;for(s=0;s<r;s++)n=t[s],e[n]=i[n];return e}function formDataToJSON(i){function e(t,s,r,n){let o=t[n++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),h=n>=t.length;return o=!o&&utils$1.isArray(r)?r.length:o,h?(utils$1.hasOwnProp(r,o)?r[o]=[r[o],s]:r[o]=s,!a):((!r[o]||!utils$1.isObject(r[o]))&&(r[o]=[]),e(t,s,r[o],n)&&utils$1.isArray(r[o])&&(r[o]=arrayToObject(r[o])),!a)}if(utils$1.isFormData(i)&&utils$1.isFunction(i.entries)){const t={};return utils$1.forEachEntry(i,(s,r)=>{e(parsePropPath(s),r,t,0)}),t}return null}function stringifySafely(i,e,t){if(utils$1.isString(i))try{return(e||JSON.parse)(i),utils$1.trim(i)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(i)}const defaults={transitional:transitionalDefaults,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",r=s.indexOf("application/json")>-1,n=utils$1.isObject(e);if(n&&utils$1.isHTMLForm(e)&&(e=new FormData(e)),utils$1.isFormData(e))return r?JSON.stringify(formDataToJSON(e)):e;if(utils$1.isArrayBuffer(e)||utils$1.isBuffer(e)||utils$1.isStream(e)||utils$1.isFile(e)||utils$1.isBlob(e)||utils$1.isReadableStream(e))return e;if(utils$1.isArrayBufferView(e))return e.buffer;if(utils$1.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(n){if(s.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(e,this.formSerializer).toString();if((a=utils$1.isFileList(e))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return toFormData(a?{"files[]":e}:e,h&&new h,this.formSerializer)}}return n||r?(t.setContentType("application/json",!1),stringifySafely(e)):e}],transformResponse:[function(e){const t=this.transitional||defaults.transitional,s=t&&t.forcedJSONParsing,r=this.responseType==="json";if(utils$1.isResponse(e)||utils$1.isReadableStream(e))return e;if(e&&utils$1.isString(e)&&(s&&!this.responseType||r)){const o=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?AxiosError.from(a,AxiosError.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$1.forEach(["delete","get","head","post","put","patch"],i=>{defaults.headers[i]={}});const defaults$1=defaults,ignoreDuplicateOf=utils$1.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=i=>{const e={};let t,s,r;return i&&i.split(`
`).forEach(function(o){r=o.indexOf(":"),t=o.substring(0,r).trim().toLowerCase(),s=o.substring(r+1).trim(),!(!t||e[t]&&ignoreDuplicateOf[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},$internals=Symbol("internals");function normalizeHeader(i){return i&&String(i).trim().toLowerCase()}function normalizeValue(i){return i===!1||i==null?i:utils$1.isArray(i)?i.map(normalizeValue):String(i)}function parseTokens(i){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(i);)e[s[1]]=s[2];return e}const isValidHeaderName=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function matchHeaderValue(i,e,t,s,r){if(utils$1.isFunction(s))return s.call(this,e,t);if(r&&(e=t),!!utils$1.isString(e)){if(utils$1.isString(s))return e.indexOf(s)!==-1;if(utils$1.isRegExp(s))return s.test(e)}}function formatHeader(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function buildAccessors(i,e){const t=utils$1.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(i,s+t,{value:function(r,n,o){return this[s].call(this,e,r,n,o)},configurable:!0})})}class AxiosHeaders{constructor(e){e&&this.set(e)}set(e,t,s){const r=this;function n(a,h,c){const u=normalizeHeader(h);if(!u)throw new Error("header name must be a non-empty string");const d=utils$1.findKey(r,u);(!d||r[d]===void 0||c===!0||c===void 0&&r[d]!==!1)&&(r[d||h]=normalizeValue(a))}const o=(a,h)=>utils$1.forEach(a,(c,u)=>n(c,u,h));if(utils$1.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(utils$1.isString(e)&&(e=e.trim())&&!isValidHeaderName(e))o(parseHeaders(e),t);else if(utils$1.isHeaders(e))for(const[a,h]of e.entries())n(h,a,s);else e!=null&&n(t,e,s);return this}get(e,t){if(e=normalizeHeader(e),e){const s=utils$1.findKey(this,e);if(s){const r=this[s];if(!t)return r;if(t===!0)return parseTokens(r);if(utils$1.isFunction(t))return t.call(this,r,s);if(utils$1.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=normalizeHeader(e),e){const s=utils$1.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||matchHeaderValue(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let r=!1;function n(o){if(o=normalizeHeader(o),o){const a=utils$1.findKey(s,o);a&&(!t||matchHeaderValue(s,s[a],a,t))&&(delete s[a],r=!0)}}return utils$1.isArray(e)?e.forEach(n):n(e),r}clear(e){const t=Object.keys(this);let s=t.length,r=!1;for(;s--;){const n=t[s];(!e||matchHeaderValue(this,this[n],n,e,!0))&&(delete this[n],r=!0)}return r}normalize(e){const t=this,s={};return utils$1.forEach(this,(r,n)=>{const o=utils$1.findKey(s,n);if(o){t[o]=normalizeValue(r),delete t[n];return}const a=e?formatHeader(n):String(n).trim();a!==n&&delete t[n],t[a]=normalizeValue(r),s[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return utils$1.forEach(this,(s,r)=>{s!=null&&s!==!1&&(t[r]=e&&utils$1.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(r=>s.set(r)),s}static accessor(e){const s=(this[$internals]=this[$internals]={accessors:{}}).accessors,r=this.prototype;function n(o){const a=normalizeHeader(o);s[a]||(buildAccessors(r,o),s[a]=!0)}return utils$1.isArray(e)?e.forEach(n):n(e),this}}AxiosHeaders.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);utils$1.reduceDescriptors(AxiosHeaders.prototype,({value:i},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(s){this[t]=s}}});utils$1.freezeMethods(AxiosHeaders);const AxiosHeaders$1=AxiosHeaders;function transformData(i,e){const t=this||defaults$1,s=e||t,r=AxiosHeaders$1.from(s.headers);let n=s.data;return utils$1.forEach(i,function(a){n=a.call(t,n,r.normalize(),e?e.status:void 0)}),r.normalize(),n}function isCancel(i){return!!(i&&i.__CANCEL__)}function CanceledError(i,e,t){AxiosError.call(this,i??"canceled",AxiosError.ERR_CANCELED,e,t),this.name="CanceledError"}utils$1.inherits(CanceledError,AxiosError,{__CANCEL__:!0});function settle(i,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?i(t):e(new AxiosError("Request failed with status code "+t.status,[AxiosError.ERR_BAD_REQUEST,AxiosError.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function parseProtocol(i){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return e&&e[1]||""}function speedometer(i,e){i=i||10;const t=new Array(i),s=new Array(i);let r=0,n=0,o;return e=e!==void 0?e:1e3,function(h){const c=Date.now(),u=s[n];o||(o=c),t[r]=h,s[r]=c;let d=n,E=0;for(;d!==r;)E+=t[d++],d=d%i;if(r=(r+1)%i,r===n&&(n=(n+1)%i),c-o<e)return;const m=u&&c-u;return m?Math.round(E*1e3/m):void 0}}function throttle(i,e){let t=0,s=1e3/e,r,n;const o=(c,u=Date.now())=>{t=u,r=null,n&&(clearTimeout(n),n=null),i.apply(null,c)};return[(...c)=>{const u=Date.now(),d=u-t;d>=s?o(c,u):(r=c,n||(n=setTimeout(()=>{n=null,o(r)},s-d)))},()=>r&&o(r)]}const progressEventReducer=(i,e,t=3)=>{let s=0;const r=speedometer(50,250);return throttle(n=>{const o=n.loaded,a=n.lengthComputable?n.total:void 0,h=o-s,c=r(h),u=o<=a;s=o;const d={loaded:o,total:a,progress:a?o/a:void 0,bytes:h,rate:c||void 0,estimated:c&&a&&u?(a-o)/c:void 0,event:n,lengthComputable:a!=null,[e?"download":"upload"]:!0};i(d)},t)},progressEventDecorator=(i,e)=>{const t=i!=null;return[s=>e[0]({lengthComputable:t,total:i,loaded:s}),e[1]]},asyncDecorator=i=>(...e)=>utils$1.asap(()=>i(...e)),isURLSameOrigin=platform.hasStandardBrowserEnv?((i,e)=>t=>(t=new URL(t,platform.origin),i.protocol===t.protocol&&i.host===t.host&&(e||i.port===t.port)))(new URL(platform.origin),platform.navigator&&/(msie|trident)/i.test(platform.navigator.userAgent)):()=>!0,cookies=platform.hasStandardBrowserEnv?{write(i,e,t,s,r,n){const o=[i+"="+encodeURIComponent(e)];utils$1.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),utils$1.isString(s)&&o.push("path="+s),utils$1.isString(r)&&o.push("domain="+r),n===!0&&o.push("secure"),document.cookie=o.join("; ")},read(i){const e=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function isAbsoluteURL(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function combineURLs(i,e){return e?i.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):i}function buildFullPath(i,e){return i&&!isAbsoluteURL(e)?combineURLs(i,e):e}const headersToObject=i=>i instanceof AxiosHeaders$1?{...i}:i;function mergeConfig(i,e){e=e||{};const t={};function s(c,u,d,E){return utils$1.isPlainObject(c)&&utils$1.isPlainObject(u)?utils$1.merge.call({caseless:E},c,u):utils$1.isPlainObject(u)?utils$1.merge({},u):utils$1.isArray(u)?u.slice():u}function r(c,u,d,E){if(utils$1.isUndefined(u)){if(!utils$1.isUndefined(c))return s(void 0,c,d,E)}else return s(c,u,d,E)}function n(c,u){if(!utils$1.isUndefined(u))return s(void 0,u)}function o(c,u){if(utils$1.isUndefined(u)){if(!utils$1.isUndefined(c))return s(void 0,c)}else return s(void 0,u)}function a(c,u,d){if(d in e)return s(c,u);if(d in i)return s(void 0,c)}const h={url:n,method:n,data:n,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(c,u,d)=>r(headersToObject(c),headersToObject(u),d,!0)};return utils$1.forEach(Object.keys(Object.assign({},i,e)),function(u){const d=h[u]||r,E=d(i[u],e[u],u);utils$1.isUndefined(E)&&d!==a||(t[u]=E)}),t}const resolveConfig=i=>{const e=mergeConfig({},i);let{data:t,withXSRFToken:s,xsrfHeaderName:r,xsrfCookieName:n,headers:o,auth:a}=e;e.headers=o=AxiosHeaders$1.from(o),e.url=buildURL(buildFullPath(e.baseURL,e.url),i.params,i.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let h;if(utils$1.isFormData(t)){if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((h=o.getContentType())!==!1){const[c,...u]=h?h.split(";").map(d=>d.trim()).filter(Boolean):[];o.setContentType([c||"multipart/form-data",...u].join("; "))}}if(platform.hasStandardBrowserEnv&&(s&&utils$1.isFunction(s)&&(s=s(e)),s||s!==!1&&isURLSameOrigin(e.url))){const c=r&&n&&cookies.read(n);c&&o.set(r,c)}return e},isXHRAdapterSupported=typeof XMLHttpRequest<"u",xhrAdapter=isXHRAdapterSupported&&function(i){return new Promise(function(t,s){const r=resolveConfig(i);let n=r.data;const o=AxiosHeaders$1.from(r.headers).normalize();let{responseType:a,onUploadProgress:h,onDownloadProgress:c}=r,u,d,E,m,p;function g(){m&&m(),p&&p(),r.cancelToken&&r.cancelToken.unsubscribe(u),r.signal&&r.signal.removeEventListener("abort",u)}let f=new XMLHttpRequest;f.open(r.method.toUpperCase(),r.url,!0),f.timeout=r.timeout;function A(){if(!f)return;const b=AxiosHeaders$1.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders()),R={data:!a||a==="text"||a==="json"?f.responseText:f.response,status:f.status,statusText:f.statusText,headers:b,config:i,request:f};settle(function(T){t(T),g()},function(T){s(T),g()},R),f=null}"onloadend"in f?f.onloadend=A:f.onreadystatechange=function(){!f||f.readyState!==4||f.status===0&&!(f.responseURL&&f.responseURL.indexOf("file:")===0)||setTimeout(A)},f.onabort=function(){f&&(s(new AxiosError("Request aborted",AxiosError.ECONNABORTED,i,f)),f=null)},f.onerror=function(){s(new AxiosError("Network Error",AxiosError.ERR_NETWORK,i,f)),f=null},f.ontimeout=function(){let x=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const R=r.transitional||transitionalDefaults;r.timeoutErrorMessage&&(x=r.timeoutErrorMessage),s(new AxiosError(x,R.clarifyTimeoutError?AxiosError.ETIMEDOUT:AxiosError.ECONNABORTED,i,f)),f=null},n===void 0&&o.setContentType(null),"setRequestHeader"in f&&utils$1.forEach(o.toJSON(),function(x,R){f.setRequestHeader(R,x)}),utils$1.isUndefined(r.withCredentials)||(f.withCredentials=!!r.withCredentials),a&&a!=="json"&&(f.responseType=r.responseType),c&&([E,p]=progressEventReducer(c,!0),f.addEventListener("progress",E)),h&&f.upload&&([d,m]=progressEventReducer(h),f.upload.addEventListener("progress",d),f.upload.addEventListener("loadend",m)),(r.cancelToken||r.signal)&&(u=b=>{f&&(s(!b||b.type?new CanceledError(null,i,f):b),f.abort(),f=null)},r.cancelToken&&r.cancelToken.subscribe(u),r.signal&&(r.signal.aborted?u():r.signal.addEventListener("abort",u)));const y=parseProtocol(r.url);if(y&&platform.protocols.indexOf(y)===-1){s(new AxiosError("Unsupported protocol "+y+":",AxiosError.ERR_BAD_REQUEST,i));return}f.send(n||null)})},composeSignals=(i,e)=>{const{length:t}=i=i?i.filter(Boolean):[];if(e||t){let s=new AbortController,r;const n=function(c){if(!r){r=!0,a();const u=c instanceof Error?c:this.reason;s.abort(u instanceof AxiosError?u:new CanceledError(u instanceof Error?u.message:u))}};let o=e&&setTimeout(()=>{o=null,n(new AxiosError(`timeout ${e} of ms exceeded`,AxiosError.ETIMEDOUT))},e);const a=()=>{i&&(o&&clearTimeout(o),o=null,i.forEach(c=>{c.unsubscribe?c.unsubscribe(n):c.removeEventListener("abort",n)}),i=null)};i.forEach(c=>c.addEventListener("abort",n));const{signal:h}=s;return h.unsubscribe=()=>utils$1.asap(a),h}},composeSignals$1=composeSignals,streamChunk=function*(i,e){let t=i.byteLength;if(!e||t<e){yield i;return}let s=0,r;for(;s<t;)r=s+e,yield i.slice(s,r),s=r},readBytes=async function*(i,e){for await(const t of readStream(i))yield*streamChunk(t,e)},readStream=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const e=i.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},trackStream=(i,e,t,s)=>{const r=readBytes(i,e);let n=0,o,a=h=>{o||(o=!0,s&&s(h))};return new ReadableStream({async pull(h){try{const{done:c,value:u}=await r.next();if(c){a(),h.close();return}let d=u.byteLength;if(t){let E=n+=d;t(E)}h.enqueue(new Uint8Array(u))}catch(c){throw a(c),c}},cancel(h){return a(h),r.return()}},{highWaterMark:2})},isFetchSupported=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",isReadableStreamSupported=isFetchSupported&&typeof ReadableStream=="function",encodeText=isFetchSupported&&(typeof TextEncoder=="function"?(i=>e=>i.encode(e))(new TextEncoder):async i=>new Uint8Array(await new Response(i).arrayBuffer())),test=(i,...e)=>{try{return!!i(...e)}catch{return!1}},supportsRequestStream=isReadableStreamSupported&&test(()=>{let i=!1;const e=new Request(platform.origin,{body:new ReadableStream,method:"POST",get duplex(){return i=!0,"half"}}).headers.has("Content-Type");return i&&!e}),DEFAULT_CHUNK_SIZE=64*1024,supportsResponseStream=isReadableStreamSupported&&test(()=>utils$1.isReadableStream(new Response("").body)),resolvers={stream:supportsResponseStream&&(i=>i.body)};isFetchSupported&&(i=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!resolvers[e]&&(resolvers[e]=utils$1.isFunction(i[e])?t=>t[e]():(t,s)=>{throw new AxiosError(`Response type '${e}' is not supported`,AxiosError.ERR_NOT_SUPPORT,s)})})})(new Response);const getBodyLength=async i=>{if(i==null)return 0;if(utils$1.isBlob(i))return i.size;if(utils$1.isSpecCompliantForm(i))return(await new Request(platform.origin,{method:"POST",body:i}).arrayBuffer()).byteLength;if(utils$1.isArrayBufferView(i)||utils$1.isArrayBuffer(i))return i.byteLength;if(utils$1.isURLSearchParams(i)&&(i=i+""),utils$1.isString(i))return(await encodeText(i)).byteLength},resolveBodyLength=async(i,e)=>{const t=utils$1.toFiniteNumber(i.getContentLength());return t??getBodyLength(e)},fetchAdapter=isFetchSupported&&(async i=>{let{url:e,method:t,data:s,signal:r,cancelToken:n,timeout:o,onDownloadProgress:a,onUploadProgress:h,responseType:c,headers:u,withCredentials:d="same-origin",fetchOptions:E}=resolveConfig(i);c=c?(c+"").toLowerCase():"text";let m=composeSignals$1([r,n&&n.toAbortSignal()],o),p;const g=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let f;try{if(h&&supportsRequestStream&&t!=="get"&&t!=="head"&&(f=await resolveBodyLength(u,s))!==0){let R=new Request(e,{method:"POST",body:s,duplex:"half"}),F;if(utils$1.isFormData(s)&&(F=R.headers.get("content-type"))&&u.setContentType(F),R.body){const[T,D]=progressEventDecorator(f,progressEventReducer(asyncDecorator(h)));s=trackStream(R.body,DEFAULT_CHUNK_SIZE,T,D)}}utils$1.isString(d)||(d=d?"include":"omit");const A="credentials"in Request.prototype;p=new Request(e,{...E,signal:m,method:t.toUpperCase(),headers:u.normalize().toJSON(),body:s,duplex:"half",credentials:A?d:void 0});let y=await fetch(p);const b=supportsResponseStream&&(c==="stream"||c==="response");if(supportsResponseStream&&(a||b&&g)){const R={};["status","statusText","headers"].forEach(O=>{R[O]=y[O]});const F=utils$1.toFiniteNumber(y.headers.get("content-length")),[T,D]=a&&progressEventDecorator(F,progressEventReducer(asyncDecorator(a),!0))||[];y=new Response(trackStream(y.body,DEFAULT_CHUNK_SIZE,T,()=>{D&&D(),g&&g()}),R)}c=c||"text";let x=await resolvers[utils$1.findKey(resolvers,c)||"text"](y,i);return!b&&g&&g(),await new Promise((R,F)=>{settle(R,F,{data:x,headers:AxiosHeaders$1.from(y.headers),status:y.status,statusText:y.statusText,config:i,request:p})})}catch(A){throw g&&g(),A&&A.name==="TypeError"&&/fetch/i.test(A.message)?Object.assign(new AxiosError("Network Error",AxiosError.ERR_NETWORK,i,p),{cause:A.cause||A}):AxiosError.from(A,A&&A.code,i,p)}}),knownAdapters={http:httpAdapter,xhr:xhrAdapter,fetch:fetchAdapter};utils$1.forEach(knownAdapters,(i,e)=>{if(i){try{Object.defineProperty(i,"name",{value:e})}catch{}Object.defineProperty(i,"adapterName",{value:e})}});const renderReason=i=>`- ${i}`,isResolvedHandle=i=>utils$1.isFunction(i)||i===null||i===!1,adapters={getAdapter:i=>{i=utils$1.isArray(i)?i:[i];const{length:e}=i;let t,s;const r={};for(let n=0;n<e;n++){t=i[n];let o;if(s=t,!isResolvedHandle(t)&&(s=knownAdapters[(o=String(t)).toLowerCase()],s===void 0))throw new AxiosError(`Unknown adapter '${o}'`);if(s)break;r[o||"#"+n]=s}if(!s){const n=Object.entries(r).map(([a,h])=>`adapter ${a} `+(h===!1?"is not supported by the environment":"is not available in the build"));let o=e?n.length>1?`since :
`+n.map(renderReason).join(`
`):" "+renderReason(n[0]):"as no adapter specified";throw new AxiosError("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return s},adapters:knownAdapters};function throwIfCancellationRequested(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new CanceledError(null,i)}function dispatchRequest(i){return throwIfCancellationRequested(i),i.headers=AxiosHeaders$1.from(i.headers),i.data=transformData.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),adapters.getAdapter(i.adapter||defaults$1.adapter)(i).then(function(s){return throwIfCancellationRequested(i),s.data=transformData.call(i,i.transformResponse,s),s.headers=AxiosHeaders$1.from(s.headers),s},function(s){return isCancel(s)||(throwIfCancellationRequested(i),s&&s.response&&(s.response.data=transformData.call(i,i.transformResponse,s.response),s.response.headers=AxiosHeaders$1.from(s.response.headers))),Promise.reject(s)})}const VERSION="1.7.9",validators$1={};["object","boolean","number","function","string","symbol"].forEach((i,e)=>{validators$1[i]=function(s){return typeof s===i||"a"+(e<1?"n ":" ")+i}});const deprecatedWarnings={};validators$1.transitional=function(e,t,s){function r(n,o){return"[Axios v"+VERSION+"] Transitional option '"+n+"'"+o+(s?". "+s:"")}return(n,o,a)=>{if(e===!1)throw new AxiosError(r(o," has been removed"+(t?" in "+t:"")),AxiosError.ERR_DEPRECATED);return t&&!deprecatedWarnings[o]&&(deprecatedWarnings[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(n,o,a):!0}};validators$1.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function assertOptions(i,e,t){if(typeof i!="object")throw new AxiosError("options must be an object",AxiosError.ERR_BAD_OPTION_VALUE);const s=Object.keys(i);let r=s.length;for(;r-- >0;){const n=s[r],o=e[n];if(o){const a=i[n],h=a===void 0||o(a,n,i);if(h!==!0)throw new AxiosError("option "+n+" must be "+h,AxiosError.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new AxiosError("Unknown option "+n,AxiosError.ERR_BAD_OPTION)}}const validator={assertOptions,validators:validators$1},validators=validator.validators;class Axios{constructor(e){this.defaults=e,this.interceptors={request:new InterceptorManager$1,response:new InterceptorManager$1}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const n=r.stack?r.stack.replace(/^.+\n/,""):"";try{s.stack?n&&!String(s.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+n):s.stack=n}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=mergeConfig(this.defaults,t);const{transitional:s,paramsSerializer:r,headers:n}=t;s!==void 0&&validator.assertOptions(s,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),r!=null&&(utils$1.isFunction(r)?t.paramsSerializer={serialize:r}:validator.assertOptions(r,{encode:validators.function,serialize:validators.function},!0)),validator.assertOptions(t,{baseUrl:validators.spelling("baseURL"),withXsrfToken:validators.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=n&&utils$1.merge(n.common,n[t.method]);n&&utils$1.forEach(["delete","get","head","post","put","patch","common"],p=>{delete n[p]}),t.headers=AxiosHeaders$1.concat(o,n);const a=[];let h=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(h=h&&g.synchronous,a.unshift(g.fulfilled,g.rejected))});const c=[];this.interceptors.response.forEach(function(g){c.push(g.fulfilled,g.rejected)});let u,d=0,E;if(!h){const p=[dispatchRequest.bind(this),void 0];for(p.unshift.apply(p,a),p.push.apply(p,c),E=p.length,u=Promise.resolve(t);d<E;)u=u.then(p[d++],p[d++]);return u}E=a.length;let m=t;for(d=0;d<E;){const p=a[d++],g=a[d++];try{m=p(m)}catch(f){g.call(this,f);break}}try{u=dispatchRequest.call(this,m)}catch(p){return Promise.reject(p)}for(d=0,E=c.length;d<E;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=mergeConfig(this.defaults,e);const t=buildFullPath(e.baseURL,e.url);return buildURL(t,e.params,e.paramsSerializer)}}utils$1.forEach(["delete","get","head","options"],function(e){Axios.prototype[e]=function(t,s){return this.request(mergeConfig(s||{},{method:e,url:t,data:(s||{}).data}))}});utils$1.forEach(["post","put","patch"],function(e){function t(s){return function(n,o,a){return this.request(mergeConfig(a||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:n,data:o}))}}Axios.prototype[e]=t(),Axios.prototype[e+"Form"]=t(!0)});const Axios$1=Axios;class CancelToken{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(n){t=n});const s=this;this.promise.then(r=>{if(!s._listeners)return;let n=s._listeners.length;for(;n-- >0;)s._listeners[n](r);s._listeners=null}),this.promise.then=r=>{let n;const o=new Promise(a=>{s.subscribe(a),n=a}).then(r);return o.cancel=function(){s.unsubscribe(n)},o},e(function(n,o,a){s.reason||(s.reason=new CanceledError(n,o,a),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new CancelToken(function(r){e=r}),cancel:e}}}const CancelToken$1=CancelToken;function spread(i){return function(t){return i.apply(null,t)}}function isAxiosError(i){return utils$1.isObject(i)&&i.isAxiosError===!0}const HttpStatusCode={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HttpStatusCode).forEach(([i,e])=>{HttpStatusCode[e]=i});const HttpStatusCode$1=HttpStatusCode;function createInstance(i){const e=new Axios$1(i),t=bind(Axios$1.prototype.request,e);return utils$1.extend(t,Axios$1.prototype,e,{allOwnKeys:!0}),utils$1.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return createInstance(mergeConfig(i,r))},t}const axios=createInstance(defaults$1);axios.Axios=Axios$1;axios.CanceledError=CanceledError;axios.CancelToken=CancelToken$1;axios.isCancel=isCancel;axios.VERSION=VERSION;axios.toFormData=toFormData;axios.AxiosError=AxiosError;axios.Cancel=axios.CanceledError;axios.all=function(e){return Promise.all(e)};axios.spread=spread;axios.isAxiosError=isAxiosError;axios.mergeConfig=mergeConfig;axios.AxiosHeaders=AxiosHeaders$1;axios.formToJSON=i=>formDataToJSON(utils$1.isHTMLForm(i)?new FormData(i):i);axios.getAdapter=adapters.getAdapter;axios.HttpStatusCode=HttpStatusCode$1;axios.default=axios;const axios$1=axios,loadedScripts$1={};class Http{constructor(e){l(this,"axios");l(this,"_latestResponse");this.axios=axios$1.create(e)}setCdn(e){e&&XMLHttpRequest&&!XMLHttpRequest.prototype.cdnUrl&&(XMLHttpRequest.prototype.cdnUrl=e,XMLHttpRequest.prototype.baseOpen=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(){const t=arguments[1];return t.startsWith("/infra/public")&&(arguments[1]=e+t),/^\/([^\/]*)\/public/.test(t)&&(arguments[1]=e+t),t.startsWith("/assets")&&(arguments[1]=e+t),t=="/conf/public"&&(arguments[1]=t),t.startsWith("http")&&(arguments[1]=t),this.baseOpen.apply(this,arguments)})}toAxiosConfig(e){if(e){const t=Object.assign({},this.axios.defaults);return e.headers&&(t.headers&&(t.headers=Object.assign({},this.axios.defaults.headers)),Object.assign(t.headers,e.headers)),e.responseType&&(t.responseType=e.responseType),e.queryParams&&(t.params=Object.assign({},e.queryParams)),t}else return this.axios.defaults}toCdnUrl(e){const t=ConfigurationFrameworkFactory.instance().Platform.cdnDomain;if((t==null?void 0:t.length)>0&&e!=="/conf/public"){const s=""+e;(s.startsWith("/infra/public")||s.startsWith("/assets")||/^\/([^\/]*)\/public/.test(s))&&(e=t+s)}return e}mapAxiosError(e,t){return e.response?this._latestResponse=e.response:e.request?this._latestResponse={status:408,statusText:ERROR_CODE.TIME_OUT}:this._latestResponse={status:500,statusText:ERROR_CODE.UNKNOWN},!t||t.disableNotifications,this._latestResponse}mapAxiosResponse(e,t){return this._latestResponse=e,e.data}get latestResponse(){return this._latestResponse}isResponseError(){return this.latestResponse.status<200||this.latestResponse.status>=300}get(e,t){return this.axios.get(this.toCdnUrl(e),this.toAxiosConfig(t)).then(s=>this.mapAxiosResponse(s,t)).catch(s=>this.mapAxiosError(s,t))}post(e,t,s){return this.axios.post(e,t,this.toAxiosConfig(s)).then(r=>this.mapAxiosResponse(r,s)).catch(r=>this.mapAxiosError(r,s))}postFile(e,t,s){const r=this.toAxiosConfig(s);return r.headers&&r.headers["Content-Type"]&&delete r.headers["Content-Type"],this.axios.post(e,t,r).then(n=>this.mapAxiosResponse(n,s)).catch(n=>this.mapAxiosError(n,s))}postJson(e,t,s){const r=this.toAxiosConfig();return r.headers&&(r.headers["Content-Type"]="application/json"),this.axios.post(e,t,this.toAxiosConfig(s)).then(n=>this.mapAxiosResponse(n,s)).catch(n=>this.mapAxiosError(n,s))}put(e,t,s){return this.axios.put(e,t,this.toAxiosConfig(s)).then(r=>this.mapAxiosResponse(r,s)).catch(r=>this.mapAxiosError(r,s))}putJson(e,t,s){const r=this.toAxiosConfig(s);return r.headers&&(r.headers["Content-Type"]="application/json"),this.axios.put(e,t,r).then(n=>this.mapAxiosResponse(n,s)).catch(n=>this.mapAxiosError(n,s))}delete(e,t){return this.axios.delete(e,this.toAxiosConfig(t)).then(s=>this.mapAxiosResponse(s,t)).catch(s=>this.mapAxiosError(s,t))}deleteJson(e,t){return this.axios.delete(e,{data:t}).then(s=>this.mapAxiosResponse(s)).catch(s=>this.mapAxiosError(s))}getScript(e,t,s){const r=s??"exports",n=this.toAxiosConfig(t);return n.headers&&(n.headers.Accept="application/javascript"),this.axios.get(this.toCdnUrl(e),n).then(o=>this.mapAxiosResponse(o,t)).then(o=>{try{const a=`"use strict";var ${r.split(".")[0]}={};${o};return ${r};`;return Function(a)()}catch{return o}}).catch(o=>{throw this.mapAxiosError(o,t),o})}loadScript(e,t){return loadedScripts$1[e]?Promise.resolve():this.getScript(e,t).then(s=>{loadedScripts$1[e]=!0})}}class TransportFramework{constructor(){l(this,"_http",new Http)}get http(){return this._http}newHttpInstance(e){return new Http(e)}}const transport=new TransportFramework;class ConfigurationFrameworkFactory{static instance(){return configure}}const http$2=transport.http;class Session{constructor(){l(this,"_me",null);l(this,"_currentLanguage","");l(this,"_notLoggedIn",!0);l(this,"_description");l(this,"_profile")}get currentLanguage(){return this._currentLanguage}get notLoggedIn(){return this._notLoggedIn}get description(){return this._description}get avatarUrl(){let e=this.description.photo;return(!e||e==="no-avatar.jpg"||e==="no-avatar.svg")&&(e=ConfigurationFrameworkFactory.instance().Platform.theme.basePath+"/img/illustrations/no-avatar.svg"),e}get user(){return this._me}get currentApp(){return configure.Platform.apps.currentApp}async initialize(){return http$2.get("/auth/oauth2/userinfo").then(e=>{if(http$2.isResponseError()||typeof e=="string")throw ERROR_CODE.NOT_LOGGED_IN;return this.setCurrentModel(e),this._notLoggedIn?this.loadDefaultLanguage():this.loadUserLanguage()}).then(e=>(this.setCurrentLanguage(e),this.loadDescription())).then(()=>this.getUserProfile()).then(()=>{notify.onSessionReady().resolve(this._me)}).catch(e=>{if(e===ERROR_CODE.NOT_LOGGED_IN)return Promise.resolve();notify.onSessionReady().reject(e)})}setCurrentModel(e){this._me=e,this._notLoggedIn=!(e&&e.sessionMetadata&&e.sessionMetadata.userId)}hasWorkflow(e){var t;return e===void 0||((t=this._me)==null?void 0:t.authorizedActions.findIndex(s=>s.name===e))!==-1}hasRight(e,t){if(t==="owner")return e.owner&&e.owner.userId===this._me.userId;const s=t.right||t,n=e.shared.filter(a=>(this._me.groupsIds||[]).indexOf(a.groupId)!==-1||a.userId===this._me.userId).find(a=>a[s]||a.manager)!==void 0,o=t.workflow?this.hasWorkflow(t.workflow):!0;return n&&o}get latestQuotaAndUsage(){return http$2.get(`/workspace/quota/user/${this._me.userId}`).then(e=>(this._description&&(this._description.quota=e.quota,this._description.storage=e.storage),e)).catch(()=>({quota:0,storage:0}))}setCurrentLanguage(e){this._currentLanguage=e,notify.onLangReady().resolve(e)}loadDefaultLanguage(){return http$2.get("/locale").then(e=>e.locale).catch(()=>this._currentLanguage)}loadDescription(){return Promise.all([http$2.get("/userbook/api/person",{requestName:"refreshAvatar"}),http$2.get("/directory/userbook/"+this._me.userId)]).then(e=>(e[0].status==="ok"&&e[0].result&&e[0].result.length>0?this._description=e[0].result[0]:this._description={},this._description.type&&!this._description.profiles&&(this._description.profiles=this._description.type),Object.assign(this._description,e[1]),this._description))}get profile(){return this._profile}getUserProfile(){return http$2.get("/userbook/api/person").then(e=>e.result).then(e=>this._profile=e[0].type)}loadUserLanguage(){return http$2.get("/userbook/preference/language").then(e=>{try{return JSON.parse(e.preference)["default-domain"]}catch{return this.loadDefaultLanguage()}}).catch(()=>this.loadDefaultLanguage())}getEmailValidationInfos(){return http$2.get("/directory/user/mailstate")}checkEmail(e){return http$2.put("/directory/user/mailstate",{email:e})}tryEmailValidation(e){return http$2.post("/directory/user/mailstate",{key:e})}getMobileValidationInfos(){return http$2.get("/directory/user/mobilestate")}checkMobile(e){return http$2.put("/directory/user/mobilestate",{mobile:e})}tryMobileValidation(e){return http$2.post("/directory/user/mobilestate",{key:e})}getMfaInfos(){return http$2.get("/auth/user/mfa/code")}tryMfaCode(e){return http$2.post("/auth/user/mfa/code",{key:e})}}class SessionFramework{constructor(){l(this,"session",new Session)}initialize(){return this.session.initialize()}login(e,t,s,r){const n=new FormData;return n.append("email",e),n.append("password",t),typeof s<"u"&&n.append("rememberMe",""+s),typeof r<"u"&&n.append("secureLocation",""+r),transport.http.post("/auth/login",n,{headers:{"content-type":"application/x-www-form-urlencoded"}}).finally(()=>{switch(transport.http.latestResponse.status){case 200:throw ERROR_CODE.MALFORMED_DATA}})}logout(){return transport.http.get("/auth/logout").finally(()=>{})}}const session=new SessionFramework;class Theme{constructor(){l(this,"_conf");l(this,"_loaded");l(this,"skinName","");l(this,"themeName","");l(this,"skin","raw");l(this,"themeUrl","/assets/themes/raw/default/");l(this,"templateOverrides",{});l(this,"portalTemplate","/assets/themes/raw/portal.html");l(this,"basePath","");l(this,"logoutCallback","/");l(this,"skins",[]);l(this,"is1D",!1);l(this,"is2D",!1);l(this,"_onSkinReady",notify.onSkinReady());l(this,"_onOverrideReady",notify.onOverridesReady())}initialize(e){return notify.onSessionReady().promise.then(()=>this.load(e))}get version(){return configure.Platform.deploymentTag}get cdnDomain(){return configure.Platform.cdnDomain}async onFullyReady(){return await this._loaded,this}onSkinReady(){return this._onSkinReady.promise}onOverrideReady(){return this._onOverrideReady.promise}async getConf(e){return this._conf=this._conf??await transport.http.getScript("/assets/theme-conf.js",{queryParams:{v:e??this.version}},"exports.conf"),this._conf}load(e){return e=e??this.version,this._loaded||(this._loaded=(session.session.notLoggedIn?this.loadDisconnected(e):this.loadConnected(e)).then(async()=>{var s,r;const t=await this.listSkins();this.is1D=((s=t.find(n=>n.child===this.skin))==null?void 0:s.parent)==="panda",this.is2D=((r=t.find(n=>n.child===this.skin))==null?void 0:r.parent)==="theme-open-ent"})),this._loaded}loadDisconnected(e){return new Promise((t,s)=>{transport.http.get("/skin",{queryParams:{v:this.version}}).then(r=>{this.skin=r.skin,this.themeUrl=`${this.cdnDomain}/assets/themes/${r.skin}/skins/default/`,this.basePath=this.themeUrl+"../../",this._onSkinReady.resolve(this),transport.http.get(`/assets/themes/${r.skin}/template/override.json`,{disableNotifications:!0,queryParams:{v:e}}).then(n=>{this.templateOverrides=n,this._onOverrideReady.resolve(n),t()}).catch(n=>{if(transport.http.latestResponse.status===404)t();else throw n})}).catch(r=>{this._onSkinReady.reject(r),this._onOverrideReady.reject(r),s()})})}loadConnected(e){return new Promise((t,s)=>{this.loadDefaultTheme(e).then(()=>{this._onSkinReady.resolve(this),transport.http.get(`/assets/themes/${this.skin}/template/override.json`,{disableNotifications:!0,queryParams:{v:e}}).then(r=>{this.templateOverrides=r,this._onOverrideReady.resolve(r),t()}).catch(r=>{if(transport.http.latestResponse.status===404)t(),this._onSkinReady.reject(r),this._onOverrideReady.reject(r);else throw r})})})}async loadDefaultTheme(e){return session.session.notLoggedIn?Promise.reject():transport.http.get("/theme",{queryParams:{_:e}}).then(t=>{this.skinName=t.skinName,this.themeName=t.themeName,this.themeUrl=t.skin,this.basePath=`${this.cdnDomain}${this.themeUrl}../../`,this.skin=this.themeUrl.split("/assets/themes/")[1].split("/")[0],this.portalTemplate=`${this.cdnDomain}/assets/themes/${this.skin}/portal.html`,this.logoutCallback=t.logoutCallback})}listThemes(){return transport.http.get("/themes")}async setDefaultTheme(e){await transport.http.get("/userbook/api/edit-userbook-info?prop=theme-"+this.skin+"&value="+e._id),await this.loadDefaultTheme(this.version)}listSkins(){return this.skins.length>0?Promise.resolve(this.skins):this.getConf().then(e=>{const t=e.overriding.find(s=>s.child===this.skin);return t!=null&&t.group?this.skins=this.skins.concat(e.overriding.filter(s=>s.group===t.group)):this.skins=this.skins.concat(e.overriding),this.skins})}async getHelpPath(){const t=(await this.listSkins()).find(s=>s.child===this.skin);return(t==null?void 0:t.help)??"/help"}}const bundle$1={},promises$1={},defaultDiacriticsRemovalMap$1=[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}];class Idiom{translate(e,t){e=e??"";let s=bundle$1[e]===void 0?e:bundle$1[e];if(t&&typeof t=="object")for(let r in t)typeof t[r]<"u"&&(s=s.replace(new RegExp("\\${"+r+"}","g"),""+t[r]));return s}addBundlePromise(e){return this.loadBundlePromise(session.session.currentLanguage,e)}addBundle(e,t){this.loadBundle(session.session.currentLanguage,e,t)}loadBundlePromise(e,t){return this.loadBundle(e,t),promises$1[t]}loadBundle(e,t,s){const r=promises$1[t];if(r)s&&r.then(s).catch(s);else{const n=new Promisified;promises$1[t]=n.promise;const o={};e&&(o["Accept-Language"]=e),transport.http.get(t,{headers:o}).then(a=>{Object.assign(bundle$1,a),typeof s=="function"&&s(),n.resolve()}).catch(a=>{typeof s=="function"&&s(),n.reject()})}}addTranslations(e,t){notify.onLangReady().promise.then(s=>{this.loadBundle(s,e+"/"+s+".json",t)})}addAllTranslations(e){return e&&e.length>0?notify.onLangReady().promise.then(t=>Promise.all(e.map(s=>this.loadBundlePromise(t,s+"/"+t+".json")))).then(()=>{}):Promise.reject()}addKeys(e){for(var t in e)typeof bundle$1[t]!="string"&&(bundle$1[t]=e[t])}removeAccents(e){for(var t=0;t<defaultDiacriticsRemovalMap$1.length;t++)e=e.replace(defaultDiacriticsRemovalMap$1[t].letters,defaultDiacriticsRemovalMap$1[t].base);return e}}class UserPreferences{constructor(){l(this,"data",{})}get(e){return this.data[e]}load(e,t){return transport.http.get("/userbook/preference/"+e).then(s=>{try{return JSON.parse(s.preference)}catch{return t??{}}}).then(s=>(this.data[e]=s??{},s))}update(e,t){return t!==void 0&&(this.data[e]=t),this}save(e){return transport.http.putJson("/userbook/preference/"+e,this.data[e])}}class User{constructor(){l(this,"_me",null);l(this,"_keepOpenOnLogout",!1);l(this,"_preferences",new UserPreferences);l(this,"_bookmarkedApps",[])}get keepOpenOnLogout(){return this._keepOpenOnLogout}get preferences(){return this._preferences}get bookmarkedApps(){return this._bookmarkedApps}initialize(e){return this.loadPublicConf(),notify.onSessionReady().promise.then(t=>{t&&this.setCurrentModel(t)})}setCurrentModel(e){this._me=e,this._preferences=new UserPreferences,this.loadBookmarks()}loadPublicConf(){return transport.http.get("/conf/public").then(e=>(this._keepOpenOnLogout=(e==null?void 0:e.keepOpenOnLogout)||!1,e))}async loadBookmarks(){await transport.http.get("/userbook/preference/apps").then(e=>{e.preference||(e.preference=null);const t=JSON.parse(e.preference);let s;if(t&&t.length&&typeof t.concat=="function"){this._bookmarkedApps=t,s={bookmarks:t.map(o=>o.name),applications:[]},transport.http.putJson("/userbook/preference/apps",s);return}else s=t;s||(s={bookmarks:[],applications:[]});let r=!0;const n=[];s.bookmarks.forEach((o,a)=>{const h=this._me.apps.find(c=>c.name===o);if(h){let c=Object.assign({},h);this._bookmarkedApps.push(c)}else n.push(o),r=!1}),n.forEach(o=>{let a=s.bookmarks.indexOf(o);a!==-1&&s.bookmarks.splice(a,1)}),r||transport.http.putJson("/userbook/preference/apps",s)})}loadAppPrefs(e){return this.preferences.load(e,{})}saveAppPrefs(e){return this.preferences.save(e)}loadLanguage(){return this.preferences.load("language",{"default-domain":session.session.currentLanguage}).then(e=>e["default-domain"])}saveLanguage(e){return this.preferences.update("language",{"default-domain":e}).save("language")}}const http$1=transport==null?void 0:transport.http;class AppConf{constructor(){l(this,"_publicConf",{});l(this,"_currentApp");l(this,"_appConf",{})}get currentApp(){return this._currentApp??null}setCurrentApp(e){return this._currentApp=e,this}async initialize(e,t=!1){t||this.setCurrentApp(e),await Promise.all([this.getPublicConf(e),this.loadI18n(e)])}async getPublicConf(e){return this._publicConf[e]||(this._publicConf[e]=await http$1.get(`/${e}/conf/public`,{queryParams:{_:configure.Platform.deploymentTag}})),this._publicConf[e]}async getWebAppConf(e){let t;return this._appConf[e]||(await http$1.get("/applications-list")).apps.forEach(r=>{if(r!=null&&r.prefix){const n=r.prefix.replace("/","");this._appConf[n]=r}else r!=null&&r.name&&r.name.toLowerCase()==e&&(t=r)}),this._appConf[e]??t}async loadI18n(e){return await notify.onLangReady().promise,configure.Platform.idiom.addBundlePromise(`/${e}/i18n`)}}class Analytics{constructor(){l(this,"_status","void");l(this,"_params")}get status(){return this._status}xiti(){return this.parametersWithCheck("xiti",!1)}parameters(e){return this.parametersWithCheck(e,!0)}async parametersWithCheck(e,t){return this.initialize().promise.then(s=>!t||s.type===e||s.type==="multiple"?s[e]:void 0)}initialize(){return this._params||(this._params=notify.promisify(),this._status="pending",Promise.all([transport.http.get("/analyticsConf"),transport.http.get("/xiti/config")]).then(async e=>{var t;if(!e||!e[0]||!e[0].type)throw ERROR_CODE.MALFORMED_DATA;e[1]&&e[1].active&&(e[0].xiti=await this.initializeXiti(e[1])),(t=this._params)==null||t.resolve(e[0]),this._status="ready"}).catch(e=>{var t;throw this._status="failed",(t=this._params)==null||t.reject(),e})),this._params}async initializeXiti(e){if(!e.structureMap||!configure.Platform.apps.currentApp)return;const t=await notify.onSessionReady().promise,s=session.session.description;let r;for(let c of t.structures){const u=e.structureMap[c];if(u&&u.collectiviteId&&u.UAI){r=u;break}}if(!r||!r.active)return;const n=await configure.Platform.apps.getPublicConf(configure.Platform.apps.currentApp);if(!n)return;const o=n.xiti;if(!o||!o.LIBELLE_SERVICE||!r.UAI)return;function a(c){let u="";for(let d=0;d<c.length;d++)u+=c.charCodeAt(d);return u}const h={Student:"ELEVE",Teacher:"ENSEIGNANT",Relative:"PARENT",Personnel:"ADMIN_VIE_SCOL_TECH",Guest:"AUTRE"};return{LIBELLE_SERVICE:o.LIBELLE_SERVICE,TYPE:o.OUTIL?"TIERS":"NATIF",OUTIL:o.OUTIL?o.OUTIL:"",STRUCT_ID:r.collectiviteId,STRUCT_UAI:r.UAI,PROJET:r.projetId?r.projetId:e.ID_PROJET,EXPLOITANT:e.ID_EXPLOITANT,PLATFORME:r.plateformeId?r.plateformeId:e.ID_PLATEFORME,ID_PERSO:a(t.userId),PROFILE:s.profiles&&s.profiles.length>0?h[s.profiles[0]]??"":""}}}class ConfigurationFramework{constructor(){l(this,"Platform",{deploymentTag:"",cdnDomain:"",apps:new AppConf,theme:new Theme,analytics:new Analytics,idiom:new Idiom,listLanguages:()=>transport.http.get("/languages")});l(this,"School",{});l(this,"User",new User)}async initialize(e,t){if(!e){const r=c=>(c<10?"0":"")+c.toFixed(0),n=new Date,o=n.getFullYear(),a=n.getMonth()+1,h=n.getDate();e=`${o}${r(a)}${r(h)}`}const s=e;this.Platform.deploymentTag=e,typeof t=="string"&&t.length>0&&(this.Platform.cdnDomain=t),transport.http.setCdn(this.Platform.cdnDomain),await Promise.all([this.Platform.theme.initialize(s),notify.onSessionReady().promise.then(r=>this.Platform.idiom.addBundlePromise("/i18n")),this.User.initialize(s)])}}const configure=new ConfigurationFramework,http=transport==null?void 0:transport.http;var P;const me=(P=session==null?void 0:session.session)==null?void 0:P.user;class Notification{constructor(e){l(this,"_id");l(this,"model");e.reported=e.reporters&&e.reporters.length>0,this._id=e._id,this.model=e}isUnread(){var e;return((e=this.model.recipients)==null?void 0:e.find(t=>t.userId===me.userId))!==void 0}delete(){return http.delete("/timeline/"+this._id)}discard(){return http.put("/timeline/"+this._id)}report(){return http.put("/timeline/"+this._id+"/report")}}class TimelineApp{constructor(){l(this,"_notifications",[]);l(this,"_notificationTypes",[]);l(this,"_flashMessages",[]);l(this,"_pageNumber",0);l(this,"_lastPage",!1);l(this,"_loading",!1);l(this,"showMine",!1)}get notifications(){return this._notifications}get isLoading(){return this._loading}get page(){return this._pageNumber}get hasMorePage(){return!this._lastPage}get notificationTypes(){return this._notificationTypes}get selectedNotificationTypes(){return this.preferences.type=this.preferences.type||[],this.preferences.type}get preferences(){return configure.User.preferences.get(APP$1.TIMELINE)}get flashMessages(){return this._flashMessages}savePreferences(){return configure.User.saveAppPrefs(APP$1.TIMELINE)}resetPagination(){this._pageNumber=0,this._lastPage=!1,this._loading=!1}initialize(){return Promise.all([configure.User.loadAppPrefs(APP$1.TIMELINE),transport.http.get("/timeline/types")]).then(e=>{this._notificationTypes=e[1]})}loadNotifications(e){if(this._loading||this._lastPage)return Promise.resolve();e&&(this._pageNumber++,this._lastPage=!1);let t=this.selectedNotificationTypes;if(t.length===0)return this._lastPage=!0,Promise.resolve();let s={page:this.page,mine:1};return this.showMine||delete s.mine,this._loading=!0,transport.http.get(`/timeline/lastNotifications?type=${t.join("&type=")}`,{queryParams:s}).then(r=>{if(this._loading=!1,r.status==="ok")if(r.number&&r.results){const n=r.results.filter(o=>this._notifications.findIndex(a=>a._id===o._id)===-1).map(o=>new Notification(o));this._notifications=this._notifications.concat(n),this._pageNumber++}else this._lastPage=!0}).catch(r=>{this._loading=!1})}loadFlashMessages(){return transport.http.get("/timeline/flashmsg/listuser").then(e=>{this._flashMessages=e})}markAsRead(e){return transport.http.put("/timeline/flashmsg/"+e.id+"/markasread")}}class ITimelineFactory{static createInstance(){return new TimelineApp}}const ReactionTypes=["REACTION_1","REACTION_2","REACTION_3","REACTION_4"];class NotifyFrameworkFactory{static instance(){return notify}}const LAYER_NAME={WIDGETS:"widgets",EXPLORER:"explorer",TRANSPORT:"transport",WEB_DATA:"webDataPipeline"},EVENT_NAME={USERPREF_CHANGED:"userprefChanged",SEARCH_RESULTED:"searchResulted",ERROR_OCCURED:"error",DATA_TRACKED:"track"};class ServiceRegistry extends Map{register({application:e,resourceType:t},s){this.set(`${e}:main`,s),this.set(`${e}:${t}`,s)}findService(e,t){return this.lookupService(e,t)}findMainService({application:e},t){return this.lookupService({application:e,resourceType:"main"},t)}isRegistered({application:e,resourceType:t}){return this.get(`${e}:${t}`)!==void 0}lookupService({application:e,resourceType:t},s){const r=this.get(`${e}:${t}`);if(r===void 0)throw`Service not found: ${e}:${t}`;return r(s)}}const w=class w{constructor(e){l(this,"checkHttpResponse",e=>{if(this.http.latestResponse.status>=300)throw this.http.latestResponse.statusText;return e});this.context=e}get http(){return this.context.http()}async copy(e){const t=await this.http.post("/archive/duplicate",{application:e.application,resourceId:e.resourceId});return this.checkHttpResponse(t)}async publish(e){const t=new FormData;return t.append("title",e.title),t.append("cover",e.cover),t.append("coverName",e.cover.name),t.append("coverType",e.cover.type),t.append("teacherAvatar",e.teacherAvatar),t.append("teacherAvatarName",e.teacherAvatar.name||`teacherAvatar_${e.userId}`),t.append("teacherAvatarType",e.teacherAvatar.type),t.append("language",e.language),e.activityType.forEach(n=>{t.append("activityType[]",n)}),e.subjectArea.forEach(n=>{t.append("subjectArea[]",n)}),e.age.forEach(n=>{t.append("age[]",n.toString())}),t.append("description",e.description),e.keyWords.split(",").forEach(n=>{t.append("keyWords[]",n.trim())}),t.append("licence",e.licence),t.append("pdfUri",`${window.location.origin}${this.getPrintUrl(e.resourceEntId)}`),t.append("application",e.application?e.application:""),t.append("resourceId",e.resourceId),t.append("teacherSchool",e.userStructureName),await this.http.post("/appregistry/library/resource",t,{headers:{"Content-Type":"multipart/form-data"}})}async createContext(e){const t=await this.http.get("/explorer/context",{queryParams:this.toQueryParams(e)});return this.checkHttpResponse(t)}async searchContext(e){const t=await this.http.get("/explorer/resources",{queryParams:this.toQueryParams(e)});return this.checkHttpResponse(t)}async searchResource(e){const t=await this.http.get(`/explorer/resources/${e.id}`,{queryParams:this.getResourceParams(e)});return this.checkHttpResponse(t)}async createFolder(e){const t=await this.http.post("/explorer/folders",this.createFolderToBodyParams(e));return this.checkHttpResponse(t)}async updateFolder(e){const t=await this.http.put(`/explorer/folders/${e.folderId}`,this.createFolderToBodyParams(e));return this.checkHttpResponse(t)}async moveToFolder(e,t=!1){e.resourceIds=t?await this.mapAssetIdToIds({application:e.application,assetIds:e.resourceIds}):e.resourceIds;const s=await this.http.post(`/explorer/folders/${e.folderId}/move`,this.moveToBodyParams(e));return this.checkHttpResponse(s)}async listSubfolders(e){const t=await this.http.get(`/explorer/folders/${e}`);return this.checkHttpResponse(t)}async deleteAll(e,t=!1){e.resourceIds=t?await this.mapAssetIdToIds({application:e.application,assetIds:e.resourceIds}):e.resourceIds;const s=await this.http.deleteJson("/explorer",e);return this.checkHttpResponse(s)}async trashAll({resourceType:e,...t},s=!1){t.resourceIds=s?await this.mapAssetIdToIds({application:t.application,assetIds:t.resourceIds}):t.resourceIds;const r=await this.http.putJson("/explorer/trash",t);return this.checkHttpResponse(r)}async restoreAll({resourceType:e,...t},s=!1){t.resourceIds=s?await this.mapAssetIdToIds({application:t.application,assetIds:t.resourceIds}):t.resourceIds;const r=await this.http.putJson("/explorer/restore",t);return this.checkHttpResponse(r)}async mapAssetIdToIds({application:e,assetIds:t}){const s=await this.searchContext({application:e,pagination:{startIdx:0,pageSize:t.length+1},types:[],filters:{},asset_id:t});return t.map(r=>{const n=s.resources.find(o=>o.assetId===r);if(n===void 0)throw"explorer.assetid.notfound";return n.id})}async getThumbnailPath(e){if(typeof e>"u")return e;if(typeof e=="string")if(e.startsWith("blob:")){const t=await fetch(e).then(r=>r.blob());return`/workspace/document/${(await this.context.workspace().saveFile(t,{visibility:"protected",application:this.getApplication()}))._id}`}else return e;else return`/workspace/document/${(await this.context.workspace().saveFile(e,{visibility:"protected",application:this.getApplication()}))._id}`}toQueryParams(e){const t={application:e.application,start_idx:e.pagination.startIdx,page_size:e.pagination.pageSize,trashed:e.trashed};if(e.types.length>0&&(t.resource_type=e.types[0]),e.orders&&Object.entries(e.orders).length){const[[s,r]]=Object.entries(e.orders);t.order_by=`${s}:${r}`}return e.filters&&Object.assign(t,e.filters),typeof e.search=="string"&&(t.search=e.search),typeof e.asset_id<"u"&&(t.asset_id=[...e.asset_id]),typeof e.id<"u"&&(t.id=e.id),t}getResourceParams(e){return{application:e.application}}createFolderToBodyParams(e){return{application:e.application,resourceType:e.type,parentId:e.parentId,name:e.name}}moveToBodyParams(e){return{application:e.application,resourceType:this.getResourceType(),resourceIds:e.resourceIds,folderIds:e.folderIds}}};l(w,"registry",new ServiceRegistry),l(w,"register",w.registry.register.bind(w.registry)),l(w,"findService",w.registry.findService.bind(w.registry)),l(w,"findMainService",w.registry.findMainService.bind(w.registry)),l(w,"isRegistered",w.registry.isRegistered.bind(w.registry));let ResourceService=w;const APP="scrapbook",RESOURCE="scrapbook";class ScrapbookResourceService extends ResourceService{create(e){throw new Error("Method not implemented.")}async update(e){const t=await this.getThumbnailPath(e.thumbnail),s=await this.http.put(`/scrapbook/${e.entId}`,{trashed:e.trashed?1:0,title:e.name,icon:t,subTitle:e.description});return this.checkHttpResponse(s),{thumbnail:t,entId:e.entId}}getResourceType(){return RESOURCE}getApplication(){return APP}getFormUrl(e){return e?`/scrapbook?folderid=${e}#/create-scrapbook/`:"/scrapbook#/create-scrapbook/"}getViewUrl(e){return`/scrapbook#/view-scrapbook/${e}`}getPrintUrl(e){return`/scrapbook/print#/print-scrapbook/${e}`}getEditUrl(e){return`/scrapbook#/edit-scrapbook/${e}`}getExportUrl(e){return`/scrapbook/exportHtml/${e}`}}ResourceService.register({application:RESOURCE,resourceType:RESOURCE},i=>new ScrapbookResourceService(i));const globalCache={},mutexPromise={};class CacheService{constructor(e){this.context=e}get http(){return this.context.http()}async fromCacheIfPossible(e,t,s){if(mutexPromise[e]&&await mutexPromise[e],globalCache[e])return globalCache[e];try{const r=t();mutexPromise[e]=r;const n=await r;return s(n)&&(globalCache[e]=n),n}catch(r){throw console.error(`Failed to retrieve value for: ${e}`,r),r}}clearCache(e){if(e)delete globalCache[e];else for(const t in globalCache)globalCache.hasOwnProperty(t)&&delete globalCache[t]}async httpGet(e,t){return this.fromCacheIfPossible(e,async()=>{const s=await this.http.get(e,t),r={...this.http.latestResponse};return{value:s,response:r}},({response:s})=>!(s.status<200||s.status>=300))}async httpGetJson(e,t){const{response:s,value:r}=await this.httpGet(e,t);if(s.status<200||s.status>=300)throw`Bad http status (${s.status}) for url: ${e}`;return r}}class ConfService{constructor(e){this.context=e}get http(){return this.context.http()}get cache(){return this.context.cache()}get cdnDomain(){return configure.Platform.cdnDomain}get notify(){return this.context.notify()}async getConf(e){const[t,s]=await Promise.all([this.getThemeConf(),this.getApplicationsList()]),[r,n]=await Promise.all([this.getTheme({conf:t,publicTheme:s===void 0}),this.getWebAppConf({app:e,applications:s??[]})]),o={app:e,applications:s??[],conf:t,currentApp:n,theme:r};return this.notify.onAppConfReady().resolve(o),o}async getPublicConf(e){const{response:t,value:s}=await this.cache.httpGet(`/${e}/conf/public`,{queryParams:{_:configure.Platform.deploymentTag}});if(t.status<200||t.status>=300)throw ERROR_CODE.APP_NOT_FOUND;return s}getCdnUrl(){}async savePreference(e,t){this.http.putJson(`/userbook/preference/${e}`,t)}async getPreference(e){const t=await this.http.get(`/userbook/preference/${e}`);return this.http.isResponseError()||typeof t=="string"?{}:JSON.parse(t.preference)}async getThemeConf(e){return await this.http.getScript("/assets/theme-conf.js",{queryParams:{v:e}},"exports.conf")}async getApplicationsList(){const e=await this.http.get("/applications-list");if(!(this.http.isResponseError()||typeof e=="string"))return e.apps}async getWebAppConf({app:e,applications:t}){return t.find(r=>{if(r!=null&&r.prefix)return(r==null?void 0:r.prefix.replace("/",""))===e})}async getTheme({version:e,conf:t,publicTheme:s}){const{value:r}=await this.cache.httpGet("/theme",{queryParams:{_:e}}),n=s?null:r,o=t==null?void 0:t.overriding.find(m=>n===null||m.child===n.themeName),a=(n==null?void 0:n.skinName)||o.skins[0],h=(n==null?void 0:n.skin)||`/assets/themes/${o.child}/skins/${a}/`,c=o.skins,u="/assets/themes/edifice-bootstrap",d=o.bootstrapVersion.split("-").slice(-1)[0],E=o.parent==="panda";return{basePath:`${this.cdnDomain}${h}../../`,bootstrapPath:u,bootstrapVersion:d,is1d:E,logoutCallback:(n==null?void 0:n.logoutCallback)||"/",skin:o.child,skinName:a,skins:c,themeName:o.child,themeUrl:h,npmTheme:o.npmTheme??void 0}}async getLogoutCallback(e){const{response:t,value:s}=await this.cache.httpGet("/theme",{queryParams:{_:e}});if(t.status<200||t.status>=300)throw ERROR_CODE.NOT_LOGGED_IN;return s.logoutCallback}}class DirectoryService{constructor(e){this.odeServices=e}get http(){return this.odeServices.http()}get cache(){return this.odeServices.cache()}getAvatarUrl(e,t,s="100x100"){return t==="user"?`/userbook/avatar/${e}?thumbnail=${s}`:"/assets/img/illustrations/group-avatar.svg"}getDirectoryUrl(e,t){return t==="user"?`/userbook/annuaire#/${e}`:`/userbook/annuaire#/group-view/${e}`}async getBookMarks(){return(await this.cache.httpGetJson("/directory/sharebookmark/all")).map(({id:t,name:s})=>({id:t,displayName:s,members:[]}))}async getBookMarkById(e){const{groups:t,id:s,name:r,users:n}=await this.http.get(`/directory/sharebookmark/${e}`);return{id:s,displayName:r,groups:t.map(({name:o,id:a})=>({displayName:o,id:a})),users:n.map(({displayName:o,id:a,profile:h})=>({profile:h,displayName:o,firstName:"",lastName:"",login:"",id:a}))}}async saveBookmarks(e,{bookmarks:t,groups:s,users:r}){this.cache.clearCache("/directory/sharebookmark/all");const n=r.map(E=>typeof E=="string"?E:E.id),o=s.map(E=>typeof E=="string"?E:E.id),a=t.map(async E=>{if(typeof E=="string"){const{displayName:m,groups:p,id:g,users:f}=await this.getBookMarkById(E),A=f.map(x=>x.id),y=p.map(x=>x.id);return{displayName:m,id:g,members:[...y,...A]}}else return Promise.resolve(E)}),c=(await Promise.all(a)).map(E=>E.members).reduce((E,m)=>[...E,...m],[]),u={name:e,members:[...n,...o,...c]},{id:d}=await this.http.postJson("/directory/sharebookmark",u);return{id:d,displayName:e,members:u.members}}}const loadedScripts={};class HttpService{constructor(e,t){l(this,"axios");l(this,"baseUrl");l(this,"headers",{});l(this,"_latestResponse");this.context=e,this.axios=axios$1.create(t)}fixBaseUrl(e){return e.startsWith("http://")||e.startsWith("https://")?e:this.baseUrl?this.baseUrl.endsWith("/")||e.startsWith("/")?`${this.baseUrl}${e}`:`${this.baseUrl}/${e}`:e}useBaseUrl(e){return this.baseUrl=e,this}useHeaders(e){return this.headers=e,this}setCdn(e){e&&XMLHttpRequest&&!XMLHttpRequest.prototype.cdnUrl&&(XMLHttpRequest.prototype.cdnUrl=e,XMLHttpRequest.prototype.baseOpen=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(){const t=arguments[1];return t.startsWith("/infra/public")&&(arguments[1]=e+t),/^\/([^\/]*)\/public/.test(t)&&(arguments[1]=e+t),t.startsWith("/assets")&&(arguments[1]=e+t),t=="/conf/public"&&(arguments[1]=t),t.startsWith("http")&&(arguments[1]=t),this.baseOpen.apply(this,arguments)})}toAxiosConfig(e){if(e){const t=Object.assign({},this.axios.defaults);e.headers&&(t.headers=Object.assign({},this.axios.defaults.headers),Object.assign(t.headers,e.headers)),e.responseType&&(t.responseType=e.responseType),e.queryParams&&(t.params=Object.assign({},e.queryParams));const s=t.headers??{};return t.headers={...s,...this.headers},t}else return this.axios.defaults}toCdnUrl(e){e=this.fixBaseUrl(e);const t=this.context.conf().getCdnUrl()||"";if(t.length>0&&e!=="/conf/public"){const s=""+e;(s.startsWith("/infra/public")||s.startsWith("/assets")||/^\/([^\/]*)\/public/.test(s))&&(e=t+s)}return e}mapAxiosError(e,t){e.response?this._latestResponse=e.response:e.request?this._latestResponse={status:408,statusText:ERROR_CODE.TIME_OUT}:this._latestResponse={status:500,statusText:ERROR_CODE.UNKNOWN};const{status:s,statusText:r,headers:n,data:o}=this._latestResponse;return t!=null&&t.disableNotifications||notify.events().publish(LAYER_NAME.TRANSPORT,{name:EVENT_NAME.ERROR_OCCURED,data:{params:t,response:{status:s,statusText:r,headers:n},payload:o}}),o}mapAxiosResponse(e,t){return this._latestResponse=e,e.data}get latestResponse(){return this._latestResponse}isResponseError(){return this.latestResponse.status<200||this.latestResponse.status>=300}async get(e,t){try{const s=await this.axios.get(this.toCdnUrl(e),this.toAxiosConfig(t));return this.mapAxiosResponse(s,t)}catch(s){throw this.mapAxiosError(s,t)}}async post(e,t,s){try{const r=await this.axios.post(this.fixBaseUrl(e),t,this.toAxiosConfig(s));return this.mapAxiosResponse(r,s)}catch(r){throw this.mapAxiosError(r,s)}}async postFile(e,t,s){const r=this.toAxiosConfig(s);r.headers&&r.headers["Content-Type"]&&delete r.headers["Content-Type"];try{const n=await this.axios.post(this.fixBaseUrl(e),t,{...r,headers:{"Content-Type":"multipart/form-data"}});return this.mapAxiosResponse(n,s)}catch(n){throw this.mapAxiosError(n,s)}}async postJson(e,t,s){const r=this.toAxiosConfig();r.headers&&(r.headers["Content-Type"]="application/json");try{const n=await this.axios.post(this.fixBaseUrl(e),t,this.toAxiosConfig(s));return this.mapAxiosResponse(n,s)}catch(n){throw this.mapAxiosError(n,s)}}async put(e,t,s){try{const r=await this.axios.put(this.fixBaseUrl(e),t,this.toAxiosConfig(s));return this.mapAxiosResponse(r,s)}catch(r){throw this.mapAxiosError(r,s)}}async putFile(e,t,s){try{const r=this.toAxiosConfig(s);r.headers&&r.headers["Content-Type"]&&delete r.headers["Content-Type"];const n=await this.axios.put(this.fixBaseUrl(e),t,{...r,headers:{"Content-Type":"multipart/form-data"}});return this.mapAxiosResponse(n,s)}catch(r){throw this.mapAxiosError(r,s)}}async putJson(e,t,s){const r=this.toAxiosConfig(s);r.headers&&(r.headers["Content-Type"]="application/json");try{const n=await this.axios.put(this.fixBaseUrl(e),t,r);return this.mapAxiosResponse(n,s)}catch(n){throw this.mapAxiosError(n,s)}}async delete(e,t){try{const s=await this.axios.delete(this.fixBaseUrl(e),this.toAxiosConfig(t));return this.mapAxiosResponse(s,t)}catch(s){throw this.mapAxiosError(s,t)}}async deleteJson(e,t){try{const s=await this.axios.delete(this.fixBaseUrl(e),{data:t});return this.mapAxiosResponse(s)}catch(s){throw this.mapAxiosError(s)}}getScript(e,t,s){const r=s??"exports",n=this.toAxiosConfig(t);return n.headers&&(n.headers.Accept="application/javascript"),this.axios.get(this.toCdnUrl(e),n).then(o=>this.mapAxiosResponse(o,t)).then(o=>{try{const a=`"use strict";var ${r.split(".")[0]}={};${o};return ${r};`;return Function(a)()}catch{return o}}).catch(o=>{throw this.mapAxiosError(o,t),o})}loadScript(e,t){return loadedScripts[e]?Promise.resolve():this.getScript(e,t).then(s=>{loadedScripts[e]=!0})}}class RightService{constructor(e){this.context=e}get session(){return this.context.session()}parseResourceRight(e){const t=e.split(":");if(t.length===2){if(t[0]==="creator")return{id:t[1],right:"creator",type:"creator"}}else return t.length===3?{id:t[1],right:t[2],type:t[0]}:void 0}parseResourceRights(e){return e.map(s=>this.parseResourceRight(s)).filter(s=>s!==void 0)}hasResourceRight({id:e,groupIds:t},s,r){const n=r.map(o=>typeof o=="string"?this.parseResourceRight(o):o).filter(o=>o!==void 0);for(const o of n){if(o.id===e&&o.type==="creator")return!0;if(o.id===e&&o.type==="user"&&o.right===s)return!0;if(t.includes(o.id)&&o.type==="group"&&o.right===s)return!0}return!1}async sessionHasResourceRight(e,t){try{const s=await this.session.getUser();return!!s&&this.hasResourceRight({groupIds:s.groupsIds,id:s.userId},e,t)}catch(s){return console.error(`Unexpected error ${s} in sessionHasResourceRight()`),!1}}async sessionHasAtLeastOneResourceRight(e,t){for(const s of e)if(await this.sessionHasResourceRight(s,t))return!0;return!1}async sessionHasResourceRightForEachList(e,t){let s=0;for(const r of t)await this.sessionHasResourceRight(e,r)&&s++;return s===t.length}async sessionHasAtLeastOneResourceRightForEachList(e,t){for(const s of e){let r=0;for(const n of t)await this.sessionHasResourceRight(s,n)&&r++;if(r===t.length)return!0}return!1}hasWorkflowRight(e,t){return t.findIndex(s=>s===e)!==-1}async sessionHasWorkflowRight(e){try{const t=await this.session.getUser();return!!t&&this.hasWorkflowRight(e,t.authorizedActions.map(s=>s.name))}catch(t){return console.error(`Unexpected error ${t} in sessionHasWorkflowRight()`),!1}}async sessionHasWorkflowRights(e){const t={};try{const s=await this.session.getUser();for(const r of e)t[r]=!!s&&this.hasWorkflowRight(r,s.authorizedActions.map(n=>n.name))}catch(s){console.error(`Unexpected error ${s} in sessionHasWorkflowRights()`);for(const r of e)t[r]=!1}return t}}class SessionService{constructor(e){this.context=e}get http(){return this.context.http()}get cache(){return this.context.cache()}get conf(){return this.context.conf()}onLogout(){this.cache.clearCache()}onRefreshSession(){this.cache.clearCache()}async getSession(){const e=await this.getUser(),[t,s,r,n,o]=await Promise.all([this.getCurrentLanguage(e),this.latestQuotaAndUsage(e),this.loadDescription(e),this.getUserProfile(),this.getBookmarks(e)]);return{user:e,quotaAndUsage:s,currentLanguage:t,userDescription:r,userProfile:n,bookmarkedApps:o}}login(e,t,s,r){const n=new FormData;return n.append("email",e),n.append("password",t),typeof s<"u"&&n.append("rememberMe",""+s),typeof r<"u"&&n.append("secureLocation",""+r),this.http.post("/auth/login",n,{headers:{"content-type":"application/x-www-form-urlencoded"}}).finally(()=>{switch(this.http.latestResponse.status){case 200:throw ERROR_CODE.MALFORMED_DATA}})}async logout(){const e=await this.conf.getLogoutCallback();return this.http.get("/auth/logout?callback="+e).finally(()=>{})}async latestQuotaAndUsage(e){const t={quota:0,storage:0};if(!e)return t;try{return await this.http.get(`/workspace/quota/user/${e==null?void 0:e.userId}`)}catch(s){return console.error(s),t}}async getCurrentLanguage(e){const t=(e==null?void 0:e.sessionMetadata)&&(e==null?void 0:e.sessionMetadata.userId);try{let s;return t?s=await this.loadUserLanguage():s=await this.loadDefaultLanguage(),s}catch(s){console.error(s)}}async loadUserLanguage(){try{const e=await this.http.get("/userbook/preference/language");return JSON.parse(e.preference)["default-domain"]}catch{return await this.loadDefaultLanguage()}}async loadDefaultLanguage(){return(await this.cache.httpGetJson("/locale")).locale}async getUser(){const{response:e,value:t}=await this.cache.httpGet("/auth/oauth2/userinfo");if(!(e.status<200||e.status>=300)&&typeof t=="object")return t;throw ERROR_CODE.NOT_LOGGED_IN}hasWorkflow({workflowName:e,user:t}){return e===void 0||(t==null?void 0:t.authorizedActions.findIndex(s=>s.name===e))!==-1}async loadDescription(e){if(!e)return{};try{const[t,s]=await Promise.all([this.getUserProfile({options:{requestName:"refreshAvatar"}}),this.http.get("/directory/userbook/"+(e==null?void 0:e.userId))]);return{...s,profiles:t}}catch(t){return console.error(t),{}}}async getBookmarks(e){if(!e)return[];const t=await this.http.get("/userbook/preference/apps");t.preference||(t.preference=null);const s=JSON.parse(t.preference);let r;r=s,r||(r={bookmarks:[],applications:[]});const n=[];return r.bookmarks.forEach((o,a)=>{const h=((e==null?void 0:e.apps)||[]).find(c=>c.name===o);if(h){const c=Object.assign({},h);n.push(c)}}),n}async getUserProfile(e={}){var h,c;const{options:t={},params:s={}}=e,r=new URLSearchParams(s).toString(),n=`/userbook/api/person${r?`?${r}`:""}`,{response:o,value:a}=await this.cache.httpGet(n,t);return o.status<200||o.status>=300||typeof a=="string"?["Guest"]:((c=(h=a==null?void 0:a.result)==null?void 0:h[0])==null?void 0:c.type)||["Guest"]}async isAdml(){const e=await this.getUser();return(e==null?void 0:e.functions.ADMIN_LOCAL)!==void 0}async getWebApp(e){const t=await this.getUser();return t==null?void 0:t.apps.find(s=>{var r;return s!=null&&s.prefix?(s==null?void 0:s.prefix.replace("/",""))===e||!1:s!=null&&s.address&&((r=s.address)==null?void 0:r.split("/")[1])===e||!1})}}class StringUtils{static removeAccents(e){for(let t=0;t<defaultDiacriticsRemovalMap$1.length;t++)e=e.replace(defaultDiacriticsRemovalMap$1[t].letters,defaultDiacriticsRemovalMap$1[t].base);return e}static generateVirtualId(){return"xxxx-xxxx-xxx-xxxx".replace(/[x]/g,()=>Math.floor(Math.random()*16).toString(16))}}class ShareService{constructor(e){this.context=e}get directory(){return this.context.directory()}get http(){return this.context.http()}get cache(){return this.context.cache()}async searchShareSubjects(e,t,s){const r=StringUtils.removeAccents(s).toLowerCase(),n=await this.cache.httpGetJson(`/${e}/share/json/${t}?search=${s}`),o=n.users.visibles.filter(({username:u,firstName:d,lastName:E,login:m})=>{const p=StringUtils.removeAccents(E||"").toLowerCase(),g=StringUtils.removeAccents(d||"").toLowerCase(),f=StringUtils.removeAccents(u||"").toLowerCase(),A=StringUtils.removeAccents(m||"").toLowerCase();return f.includes(r)||g.includes(r)||p.includes(r)||A.includes(r)}).map(u=>({avatarUrl:this.directory.getAvatarUrl(u.id,"user"),directoryUrl:this.directory.getDirectoryUrl(u.id,"user"),displayName:u.username,id:u.id,profile:u.profile,type:"user"})),a=n.groups.visibles.filter(({name:u})=>StringUtils.removeAccents(u||"").toLowerCase().includes(r)).map(u=>({avatarUrl:this.directory.getAvatarUrl(u.id,"group"),directoryUrl:this.directory.getDirectoryUrl(u.id,"group"),displayName:u.name,id:u.id,type:"group",structureName:u.structureName}));return[...(await this.directory.getBookMarks()).filter(({displayName:u})=>StringUtils.removeAccents(u||"").toLowerCase().includes(r)).map(u=>({avatarUrl:"",directoryUrl:"",profile:"",displayName:u.displayName,id:u.id,type:"sharebookmark"})),...o,...a]}async getShareMapping(e){const t=await this.cache.httpGetJson(`/${e}/rights/sharing`);for(const s of Object.keys(t))if(s.includes(".")){const r=s.split(".")[1],n=t[s];delete t[s],t[r]=n}return t}getActionsAvailableFor({id:e,type:t},s,r){const o=(t==="user"?s.users.checked[e]:s.groups.checked[e])||[],a=Object.keys(r),h=[];for(const c of a)r[c].filter(E=>o.includes(E)).length>0&&h.push(c);return h}async getRightsForResource(e,t){const s=await this.directory.getBookMarks(),r=`/${e}/share/json/${t}?search=`,n=await this.cache.httpGetJson(r),o=await this.getShareMapping(e),a=await this.cache.httpGetJson("/infra/public/json/sharing-rights.json"),h=Object.keys(n.users.checked).map(m=>n.users.visibles.find(g=>g.id===m)).filter(m=>m!==void 0).map(m=>{const p=this.getActionsAvailableFor({id:m.id,type:"user"},n,o);return{id:m.id,type:"user",displayName:m.username,profile:m.profile,avatarUrl:this.directory.getAvatarUrl(m.id,"user"),directoryUrl:this.directory.getDirectoryUrl(m.id,"user"),actions:p.map(f=>{const A=a[f];return{displayName:f,id:f,priority:A.priority}})}}).sort((m,p)=>(m.displayName||"").localeCompare(p.displayName)),c=Object.keys(n.groups.checked).map(m=>n.groups.visibles.find(g=>g.id===m)).filter(m=>m!==void 0).map(m=>{const p=this.getActionsAvailableFor({id:m.id,type:"group"},n,o);return{id:m.id,type:"group",displayName:m.name,profile:void 0,avatarUrl:this.directory.getAvatarUrl(m.id,"group"),directoryUrl:this.directory.getDirectoryUrl(m.id,"group"),actions:p.map(f=>{const A=a[f];return{displayName:f,id:f,priority:A.priority}})}}).sort((m,p)=>(m.displayName||"").localeCompare(p.displayName)),u=[...h,...c],d=n.groups.visibles.map(({groupDisplayName:m,id:p,name:g})=>({displayName:m||g,id:p})),E=n.users.visibles.map(({id:m,profile:p,username:g,firstName:f,lastName:A,login:y})=>({displayName:g,firstName:f,lastName:A,login:y,profile:p,id:m}));return{rights:u,visibleBookmarks:s,visibleGroups:d,visibleUsers:E}}async saveRights(e,t,s){const r=await this.getShareMapping(e),n={bookmarks:{},groups:{},users:{}};for(const h of s){const c=h.actions.map(d=>r[d.id]).reduce((d,E)=>Array.isArray(E)?[...d,...E]:d,[]),u=[...new Set(c)];u.length>0&&(h.type==="user"?n.users[h.id]=u:h.type==="group"?n.groups[h.id]=u:n.bookmarks[h.id]=u)}const o=`/${e}/share/resource/${t}`;return this.cache.clearCache(`/${e}/share/json/${t}?search=`),await this.http.putJson(o,n)}async getActionsForApp(e){const t=await this.cache.httpGetJson("/infra/public/json/sharing-rights.json"),s=await this.getShareMapping(e);return Object.keys(t).map(n=>{const o=t[n];return{displayName:n,id:n,priority:o.priority,requires:o.requires}}).filter(n=>{var o;return((o=s[n.id])==null?void 0:o.length)>0}).sort((n,o)=>n.priority-o.priority)}}const S=class S{constructor(){l(this,"wordExtensions",new Set);l(this,"excelExtensions",new Set);l(this,"pptExtensions",new Set);l(this,"fileExtensionMap",new Map);l(this,"csvContentType",new Set);l(this,"csvExtensions",new Set);l(this,"txtExtensions",new Set);l(this,"mdExtensions",new Set);l(this,"PDF","application/pdf");l(this,"OCTET_STREAM","application/octet-stream");this.txtExtensions.add("txt"),this.mdExtensions.add("md"),this.wordExtensions.add("doc"),this.wordExtensions.add("dot"),this.wordExtensions.add("docx"),this.wordExtensions.add("dotx"),this.wordExtensions.add("docm"),this.wordExtensions.add("dotm"),this.wordExtensions.add("odt"),this.wordExtensions.add("ott"),this.wordExtensions.add("oth"),this.wordExtensions.add("odm"),this.excelExtensions.add("xls"),this.excelExtensions.add("xlt"),this.excelExtensions.add("xla"),this.excelExtensions.add("xlsx"),this.excelExtensions.add("xltx"),this.excelExtensions.add("xlsm"),this.excelExtensions.add("xltm"),this.excelExtensions.add("xlam"),this.excelExtensions.add("xlsb"),this.excelExtensions.add("ods"),this.excelExtensions.add("ots"),this.pptExtensions.add("ppt"),this.pptExtensions.add("pot"),this.pptExtensions.add("pps"),this.pptExtensions.add("ppa"),this.pptExtensions.add("pptx"),this.pptExtensions.add("potx"),this.pptExtensions.add("ppsx"),this.pptExtensions.add("ppam"),this.pptExtensions.add("pptm"),this.pptExtensions.add("potm"),this.pptExtensions.add("ppsm"),this.pptExtensions.add("odp"),this.pptExtensions.add("otp"),this.csvExtensions.add("csv"),this.fileExtensionMap.set("doc","application/msword"),this.fileExtensionMap.set("dot","application/msword"),this.fileExtensionMap.set("docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"),this.fileExtensionMap.set("dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"),this.fileExtensionMap.set("docm","application/vnd.ms-word.document.macroEnabled.12"),this.fileExtensionMap.set("dotm","application/vnd.ms-word.template.macroEnabled.12"),this.fileExtensionMap.set("xls","application/vnd.ms-excel"),this.fileExtensionMap.set("xlt","application/vnd.ms-excel"),this.fileExtensionMap.set("xla","application/vnd.ms-excel"),this.fileExtensionMap.set("xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),this.fileExtensionMap.set("xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"),this.fileExtensionMap.set("xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"),this.fileExtensionMap.set("xltm","application/vnd.ms-excel.template.macroEnabled.12"),this.fileExtensionMap.set("xlam","application/vnd.ms-excel.addin.macroEnabled.12"),this.fileExtensionMap.set("xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"),this.fileExtensionMap.set("ppt","application/vnd.ms-powerpoint"),this.fileExtensionMap.set("pot","application/vnd.ms-powerpoint"),this.fileExtensionMap.set("pps","application/vnd.ms-powerpoint"),this.fileExtensionMap.set("ppa","application/vnd.ms-powerpoint"),this.fileExtensionMap.set("pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"),this.fileExtensionMap.set("potx","application/vnd.openxmlformats-officedocument.presentationml.template"),this.fileExtensionMap.set("ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"),this.fileExtensionMap.set("ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"),this.fileExtensionMap.set("pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"),this.fileExtensionMap.set("potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"),this.fileExtensionMap.set("ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"),this.fileExtensionMap.set("odt","application/vnd.oasis.opendocument.text"),this.fileExtensionMap.set("ott","application/vnd.oasis.opendocument.text-template"),this.fileExtensionMap.set("oth","application/vnd.oasis.opendocument.text-web"),this.fileExtensionMap.set("odm","application/vnd.oasis.opendocument.text-master"),this.fileExtensionMap.set("odg","application/vnd.oasis.opendocument.graphics"),this.fileExtensionMap.set("otg","application/vnd.oasis.opendocument.graphics-template"),this.fileExtensionMap.set("odp","application/vnd.oasis.opendocument.presentation"),this.fileExtensionMap.set("otp","application/vnd.oasis.opendocument.presentation-template"),this.fileExtensionMap.set("ods","application/vnd.oasis.opendocument.spreadsheet"),this.fileExtensionMap.set("ots","application/vnd.oasis.opendocument.spreadsheet-template"),this.fileExtensionMap.set("odc","application/vnd.oasis.opendocument.chart"),this.fileExtensionMap.set("odf","application/vnd.oasis.opendocument.formula"),this.fileExtensionMap.set("odb","application/vnd.oasis.opendocument.database"),this.fileExtensionMap.set("odi","application/vnd.oasis.opendocument.image"),this.fileExtensionMap.set("oxt","application/vnd.openofficeorg.extension"),this.fileExtensionMap.set("txt","text/plain"),this.fileExtensionMap.set("md","text/markdown"),this.csvContentType.add("text/comma-separated-values"),this.csvContentType.add("text/csv"),this.csvContentType.add("application/csv")}getContentTypeForExtension(e){return this.fileExtensionMap.has(e)?this.fileExtensionMap.get(e)??null:null}getExtensionForContentType(e){for(const t of Array.from(this.fileExtensionMap.keys()))if((this.fileExtensionMap.get(t)||"").toLowerCase()==(e||"").toLowerCase())return t;return null}isWordLike(e,t){const s=this.getExtensionForContentType(e);return s?this.wordExtensions.has(s):e==this.OCTET_STREAM&&t?this.wordExtensions.has(t):!1}isExcelLike(e,t){const s=this.getExtensionForContentType(e);return s?this.excelExtensions.has(s):e==this.OCTET_STREAM&&t?this.excelExtensions.has(t):!1}isCsvLike(e,t){return this.csvContentType.has(e)?!0:e==this.OCTET_STREAM&&t?this.csvExtensions.has(t):!1}isPowerpointLike(e,t){const s=this.getExtensionForContentType(e);return s?this.pptExtensions.has(s):e==this.OCTET_STREAM&&t?this.pptExtensions.has(t):!1}isTxtLike(e,t){const s=this.getExtensionForContentType(e);return s?this.txtExtensions.has(s):e==this.OCTET_STREAM&&t?this.txtExtensions.has(t):!1}isMdLike(e,t){const s=this.getExtensionForContentType(e);return s?this.mdExtensions.has(s):e==this.OCTET_STREAM&&t?this.mdExtensions.has(t):!1}};l(S,"INSTANCE",new S);let MimeTypeUtils=S;const defaultMappers={csv:function({type:i,extension:e}){return MimeTypeUtils.INSTANCE.isCsvLike(i,e)},doc:function({type:i,extension:e}){return MimeTypeUtils.INSTANCE.isWordLike(i,e)?!0:i.indexOf("document")!==-1&&i.indexOf("wordprocessing")!==-1},xls:function({type:i,extension:e}){return MimeTypeUtils.INSTANCE.isExcelLike(i,e)?!0:i.indexOf("document")!==-1&&i.indexOf("spreadsheet")!==-1||i.indexOf("ms-excel")!==-1},img:function({type:i}){return i.indexOf("image")!==-1},pdf:function({type:i}){return i.indexOf("pdf")!==-1||i==="application/x-download"},ppt:function({type:i,extension:e}){return MimeTypeUtils.INSTANCE.isPowerpointLike(i,e)?!0:i.indexOf("document")!==-1&&i.indexOf("presentation")!==-1||i.indexOf("powerpoint")!==-1},txt:function({type:i,extension:e}){return MimeTypeUtils.INSTANCE.isTxtLike(i,e)},md:function({type:i,extension:e}){return MimeTypeUtils.INSTANCE.isMdLike(i,e)},video:function({type:i}){return i.indexOf("video")!==-1},audio:function({type:i}){return i.indexOf("audio")!==-1},zip:function({type:i}){return i.indexOf("zip")!==-1||i.indexOf("rar")!==-1||i.indexOf("tar")!==-1||i.indexOf("7z")!==-1}},v=class v{static getRole(e){var t,s;return v.role((t=e.metadata)==null?void 0:t["content-type"],!1,(s=e.metadata)==null?void 0:s.extension)}static role(e,t=!1,s){if(s&&(s=s.trim()),!e)return"unknown";this.roleMappers||console.warn("[DocumentHelper.role] should not have empty roles",this);const r={type:e,previewRole:t,extension:s};for(const n of this.roleMappers){const o=n(r);if(o)return o}return"unknown"}};l(v,"roleMappers",[e=>Object.keys(defaultMappers).find(s=>defaultMappers[s](e))]);let DocumentHelper=v;class WorkspaceService{constructor(e){this.context=e}get http(){return this.context.http()}extractMetadata(e){const t=e.name||"",s=t.split("."),r=e.type||"application/octet-stream",n=s.length>1?s[s.length-1]:"",o={"content-type":r,filename:t,size:e.size,extension:n,role:DocumentHelper.role(r,!1,n)},a=t.replace("."+o.extension,""),h=o.extension?a+"."+o.extension:a;return{basename:a,fullname:h,metadata:o}}async saveFile(e,t){const{fullname:s,metadata:r}=this.extractMetadata(e),n=new FormData;n.append("file",e,s);const o=[];((t==null?void 0:t.visibility)==="public"||(t==null?void 0:t.visibility)==="protected")&&o.push(`${t.visibility}=true`),t!=null&&t.application&&o.push(`application=${t.application}`),r.role==="img"&&o.push("quality=1"),t!=null&&t.parentId&&o.push(`parentId=${t.parentId}`);const a=await this.http.postFile(`/workspace/document?${o.join("&")}`,n);if(this.http.isResponseError())throw this.http.latestResponse.statusText;return a}async updateFile(e,t,s){const{fullname:r,metadata:n}=this.extractMetadata(t),o=new FormData;o.append("file",t,r);const a=[];n.role==="img"&&a.push("quality=1"),s!=null&&s.alt&&a.push(`alt=${s.alt}`),s!=null&&s.legend&&a.push(`legend=${s.legend}`),s!=null&&s.name&&a.push(`name=${s.name}`);const h=await this.http.putFile(`/workspace/document/${e}?${a.join("&")}`,o);if(this.http.isResponseError())throw this.http.latestResponse.statusText;return h}async deleteFile(e){const t=e.map(s=>s._id);if(t.length==0)Promise.resolve(null);else if(await this.http.deleteJson("/workspace/documents",{ids:t}),this.http.isResponseError())throw this.http.latestResponse.statusText}async acceptDocuments(e){const t=await this.context.session().getUser();return s=>s.deleted&&s.trasher?(t==null?void 0:t.userId)==s.trasher:!0}async searchDocuments(e){const t=e.filter!=="external"||e.parentId?await this.http.get("/workspace/documents",{queryParams:{...e,_:new Date().getTime()}}):[],s=await this.acceptDocuments(e);return t.filter(s)}async listDocuments(e,t){return this.searchDocuments({filter:e,parentId:t,includeall:!0})}async transferDocuments(e,t,s="protected"){const r=[];if(e.forEach(n=>{(s==="public"&&!n.public||!n.public&&!n.protected)&&r.push(n)}),r.length>0){const n=await this.http.post("/workspace/documents/transfer",{application:t,visibility:s,ids:r.map(o=>o._id)});if(this.http.isResponseError())throw this.http.latestResponse.statusText;return r.forEach((o,a)=>{const h=e.findIndex(c=>c._id===o._id);0<=h&&h<e.length&&(e[h]=n[a])}),e.filter(o=>!!o)}return e}getThumbnailUrl(e,t=0,s=0){var n,o;const r=t>0||s>0?`${t}x${s}`:"120x120";if(typeof e=="string")return e.includes("data:image")||e.includes("thumbnail")?e:`${e}${e.includes("?")?"&":"?"}thumbnail=${r}`;{const a=`/workspace/${e.public?"pub/":""}document/${e._id}?thumbnail=`,h=e.thumbnails;if((o=(n=e.metadata)==null?void 0:n["content-type"])!=null&&o.includes("video")){const c=h&&Object.keys(h).length>0?Object.keys(h)[0]:null;return c?a+c:null}else return a+r}}}const bundle={},promises={},defaultDiacriticsRemovalMap=[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}];class IdiomService{constructor(e){this.context=e}get http(){return this.context.http()}async getIdiom(e,t){await Promise.all([this.addBundlePromise(e,"/i18n"),this.addBundlePromise(e,`/${t}/i18n`)])}translate(e,t){e=e??"";let s=bundle[e]===void 0?e:bundle[e];if(t&&typeof t=="object")for(let r in t)typeof t[r]<"u"&&(s=s.replace(new RegExp("\\${"+r+"}","g"),""+t[r]));return s}addBundlePromise(e,t){return this.loadBundlePromise(e,t)}addBundle(e,t,s){this.loadBundle(e,t,s)}loadBundlePromise(e,t){return this.loadBundle(e,t),promises[t]}loadBundle(e,t,s){const r=promises[t];if(r)s&&r.then(s).catch(s);else{const n=new Promisified;promises[t]=n.promise;const o={};e&&(o["Accept-Language"]=e),this.http.get(t,{headers:o}).then(a=>{Object.assign(bundle,a),typeof s=="function"&&s(),n.resolve()}).catch(a=>{typeof s=="function"&&s(),n.reject()})}}addTranslations(e,t){notify.onLangReady().promise.then(s=>{this.loadBundle(s,e+"/"+s+".json",t)})}addAllTranslations(e){return e&&e.length>0?notify.onLangReady().promise.then(t=>Promise.all(e.map(s=>this.loadBundlePromise(t,s+"/"+t+".json")))).then(()=>{}):Promise.reject()}addKeys(e){for(var t in e)typeof bundle[t]!="string"&&(bundle[t]=e[t])}removeAccents(e){for(var t=0;t<defaultDiacriticsRemovalMap.length;t++)e=e.replace(defaultDiacriticsRemovalMap[t].letters,defaultDiacriticsRemovalMap[t].base);return e}}let ATTag;class AnalyticsService{constructor(i){this.context=i}get http(){return this.context.http()}get session(){return this.context.session()}async trackPageLoad(i,e){const[t]=await Promise.all([this.getXitiConfig(e.name.toLowerCase()),this.loadXitiScript()]);if(!t||!ATInternet)return;let s=t.LIBELLE_SERVICE.default||null;for(const r in t.LIBELLE_SERVICE)if(r!=="default"&&i.indexOf(r)>=0){s=t.LIBELLE_SERVICE[r];break}ATTag=new ATInternet.Tracker.Tag({site:t.STRUCT_ID}),ATTag.setProps({SERVICE:s,TYPE:t.TYPE,OUTIL:t.OUTIL,UAI:t.STRUCT_UAI,PROJET:t.PROJET,EXPLOITANT:t.EXPLOITANT,PLATEFORME:t.PLATFORME,PROFIL:t.PROFILE},!0),ATTag.identifiedVisitor.set({id:t.ID_PERSO,category:t.PROFILE}),ATTag.page.set({name:(e==null?void 0:e.prefix)==="userbook"?"directory":e==null?void 0:e.prefix,chapter1:"",chapter2:"",chapter3:"",level2:t.STRUCT_UAI}),ATTag.dispatch()}async getXitiConfig(i){const[e,t]=await Promise.all([this.http.get("/analyticsConf"),this.http.get("/xiti/config")]);if(!(e!=null&&e.type))throw ERROR_CODE.MALFORMED_DATA;return t!=null&&t.active&&(e.xiti=await this.getXitiTrackingParams(t,i)),e.xiti}async loadXitiScript(){if(typeof ATInternet>"u"){const scriptPath="/xiti/public/js/lib/smarttag_ENT.js",response=await this.http.get(scriptPath,{headers:{Accept:"application/javascript"}});if(this.http.latestResponse.status!=200)throw"Error while loading XiTi script";eval(response)}}async getXitiTrackingParams(i,e){if(!i.structureMap||!e)return;const t=await this.session.getUser(),s=await this.session.getUserProfile();let r;if(!(t!=null&&t.structures))return;for(const c of t.structures){const u=i.structureMap[c];if(u&&u.collectiviteId&&u.UAI){r=u;break}}if(!r||!r.active)return;const n=await configure.Platform.apps.getPublicConf(e);if(!n)return;const o=n.xiti;if(!o||!o.LIBELLE_SERVICE||!r.UAI)return;function a(c){let u="";for(let d=0;d<c.length;d++)u+=c.charCodeAt(d);return u}const h={Student:"ELEVE",Teacher:"ENSEIGNANT",Relative:"PARENT",Personnel:"ADMIN_VIE_SCOL_TECH",Guest:"AUTRE"};return{LIBELLE_SERVICE:o.LIBELLE_SERVICE,TYPE:o.OUTIL?"TIERS":"NATIF",OUTIL:o.OUTIL?o.OUTIL:"",STRUCT_ID:r.collectiviteId,STRUCT_UAI:r.UAI,PROJET:r.projetId?r.projetId:i.ID_PROJET,EXPLOITANT:i.ID_EXPLOITANT,PLATFORME:r.plateformeId?r.plateformeId:i.ID_PLATEFORME,ID_PERSO:a(t.userId),PROFILE:s&&s.length>0?h[s[0]]??"":""}}}const _=class _{constructor(e){this.context=e}get http(){return this.context.http()}get conf(){return this.context.conf()}async getVideoConf(){var t;const e=await this.conf.getPublicConf(APP$1.VIDEO);return{maxWeight:(e==null?void 0:e["max-videosize-mbytes"])??_.MAX_WEIGHT,maxDuration:(e==null?void 0:e["max-videoduration-minutes"])??_.MAX_DURATION,acceptVideoUploadExtensions:((t=e==null?void 0:e["accept-videoupload-extensions"])==null?void 0:t.map(s=>s.toUpperCase()))??[]}}async upload({data:e,appCode:t,captation:s,duration:r}){if(!e.file)throw new Error("Invalid video file.");if(!e.filename)throw new Error("Invalid video filename");const n=`${e.browser.name} ${e.browser.version}`,o=new FormData;o.append("device",e.device||""),o.append("browser",n),o.append("url",e.url),o.append("app",t),o.append("file",e.file,e.filename),o.append("weight",""+e.file.size),o.append("captation",""+s);let a=`/video/encode?captation=${s}`;r&&(a+=`&duration=${r}`);const h=await this.http.post(a,o,{headers:{"Content-Type":"multipart/form-data"}});if(h.state=="running"){let c=0,u=1;do{const d=u+c;await new Promise(m=>setTimeout(m,d*1e3)),c=u,u=Math.min(8,d);const E=await this.http.get(`/video/status/${h.processid}`);if(E.state=="succeed")return E.videoworkspaceid&&E.videosize&&this.context.data().trackVideoSave(E.videoworkspaceid,Math.round(r),E.videosize,s,e.url,n,e.device),E;if(E.state=="error")break}while(!0)}throw new Error("Video cannot be uploaded.")}};l(_,"MAX_WEIGHT",50),l(_,"MAX_DURATION",3);let VideoService=_;class EmbedderService{constructor(e){this.context=e}get http(){return this.context.http()}async getDefault(){return this.http.get("/infra/embed/default")}async getCustom(){return this.http.get("/infra/embed/custom")}getProviderFromUrl(e,t){for(const s of e)if(this.isUrlFromProvider(t,s))return s}urlIsFromPattern(e,t){const s=new RegExp("[^{}]+(?=(?:[^{}]*{[^}]*})*[^}]*$)","g"),r=new RegExp("{[^}]*}","g");let n=!0;const o=t.match(s)||[],a=[];return(t.match(r)||[]).forEach((c,u)=>{c.includes("ignore")||a.push(o[u])}),a.forEach(c=>{if(!e.includes(c)){n=!1;return}}),n}isUrlFromProvider(e,t){typeof t.url=="string"&&(t.url=[t.url]);for(const s of t.url)if(this.urlIsFromPattern(e,s))return!0;return!1}getEmbedCodeForProvider(e,t){for(const s of e.url)if(this.urlIsFromPattern(t,s)){const r=new RegExp("{[a-zA-Z0-9_.]+}","g"),n=s.match(r)||[];let o=e.embed;for(const a of n){let h=s.split(a)[0];const c=h.split("}");c.length>1&&(h=c[c.length-1]);let u=t.split(h)[1];if(!u)continue;const d=s.split(a)[1].split("{")[0];d&&(u=u.split(d)[0]);const E=new RegExp("\\"+a.replace(/}/,"\\}"),"g");o=o.replace(E,u)}return o}return""}}class AbstractBehaviourService{constructor(e){l(this,"_cache");this.context=e,this._cache=new CacheService(this.context)}getApplication(){return this.APP}getResourceType(){return this.RESOURCE}httpGet(e,t){return this._cache.httpGetJson(e,t)}dataToResource({modified:e,...t}){const s=typeof e=="string"?e:e!=null&&e.$date?""+e.$date:"";return{application:this.RESOURCE,name:t.title,creatorId:t.owner,creatorName:t.ownerName,thumbnail:t.icon,assetId:t._id,modifiedAt:s,shared:t.shared,path:t.path}}}class ActualitesBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","actualites");l(this,"RESOURCE","actualites")}async loadResources(){return(await this.httpGet("/actualites/linker/infos")).map(s=>{var r;return s.thread_icon?r=s.thread_icon+"?thumbnail=48x48":r="/img/icons/glyphicons_036_file.png",this.dataToResource({title:s.title+" ["+s.thread_title+"]",ownerName:s.username,owner:s.owner,icon:r,path:"/actualites#/view/thread/"+s.thread_id+"/info/"+s._id,_id:`${s.thread_id}#${s._id}`,shared:!!(s.shared&&s.shared.length>=0),modified:s.modified})})}}class BlogBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","blog");l(this,"RESOURCE","blog")}loadResources(){return new Promise(async(t,s)=>{try{const r=await this.httpGet("/blog/linker"),n=[];r.forEach(o=>{o.thumbnail?o.thumbnail=o.thumbnail+"?thumbnail=48x48":o.thumbnail="/img/illustrations/blog.svg";const a=o.fetchPosts.map(h=>this.dataToResource({owner:o.author.userId,ownerName:o.author.username,title:h.title+" ["+o.title+"]",_id:`${o._id}#${h._id}`,icon:o.thumbnail,path:`/blog/id/${o._id}/post/${h._id}`,shared:!!(o.shared&&o.shared.length>=0),modified:o.modified}));n.push(...a)}),t(n)}catch(r){s(r)}})}}class CollaborativewallBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","collaborativewall");l(this,"RESOURCE","collaborativewall")}async loadResources(){return(await this.httpGet("/collaborativewall/list/all")).map(s=>this.dataToResource({title:s.name,ownerName:s.owner.displayName,owner:s.owner.userId,icon:s.icon?s.icon:"/img/illustrations/collaborative-wall-default.png",path:"/collaborativewall#/view/"+s._id,_id:s._id,shared:!!(s.shared&&s.shared.length>=0),modified:s.modified}))}}class CommunityBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","community");l(this,"RESOURCE","community")}async loadResources(){return(await this.httpGet("/community/listallpages")).map(s=>{var r;return typeof s.thumbnail>"u"||s.thumbnail===""?r="/img/icons/glyphicons_036_file.png":r=s.thumbnail+"?thumbnail=48x48",this.dataToResource({title:s.name,icon:r,path:"/community#/view/"+s.id,_id:s.id,owner:"",ownerName:"",shared:!!(s.shared&&s.shared.length>=0),modified:s.name})})}}class ExercizerBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","exercizer");l(this,"RESOURCE","exercizer")}async loadResources(){return(await this.httpGet("/exercizer/subjects-scheduled")).map(s=>{const r=s.picture?s.picture+"?thumbnail=48x48":"/img/illustrations/exercizer.svg";let n,o=!1,a=JSON.parse(s.scheduled_at);return a.groupList.length>0?(o=!0,n=a.groupList[0].name):a.userList.length>0?(o=!0,n=a.userList[0].name):n="",a.groupList.length+a.userList.length>1&&(n+="..."),this.dataToResource({title:s.title,owner:s.owner,ownerName:n,icon:r,path:"/exercizer#/linker/"+s.id,_id:""+s.id,shared:o,modified:s.modified})})}}class FormulaireBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","formulaire");l(this,"RESOURCE","formulaire")}async loadResources(){return(await this.httpGet("/formulaire/forms/linker")).map(s=>(s.picture||(s.picture="/formulaire/public/img/logo.svg"),this.dataToResource({_id:""+s.id,icon:s.picture,title:s.title,ownerName:s.owner_name,owner:s.owner_id,path:s.is_public?`${window.location.origin}/formulaire-public#/form/${s.public_key}`:`${window.location.origin}/formulaire#/form/${s.id}/${s.rgpd?"rgpd":"new"}`,shared:!!(s.shared&&s.shared.length>=0),modified:""+s.date_modification})))}}class ForumBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","forum");l(this,"RESOURCE","forum")}async loadResources(){return(await this.httpGet("/forum/categories")).map(s=>this.dataToResource({_id:s._id,title:s.name,icon:s.icon||"/img/illustrations/forum.svg",path:"/forum#/view/"+s._id,ownerName:s.owner.displayName,owner:s.owner.userId,shared:!!(s.shared&&s.shared.length>=0),modified:s.modified}))}}class HomeworksBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","homeworks");l(this,"RESOURCE","homeworks")}async loadResources(){return(await this.httpGet("/homeworks/list")).filter(t=>t.owner&&t.trashed===0).map(t=>this.dataToResource({title:t.title,ownerName:t.owner.displayName,owner:t.owner.userId,icon:t.thumbnail||"/img/illustrations/homeworks.svg",path:"/homeworks#/view-homeworks/"+t._id,_id:""+t._id,shared:typeof t.shared<"u",modified:t.modified}))}}class MagnetoBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","magneto");l(this,"RESOURCE","magneto")}async loadResources(){const{all:t}=await this.httpGet("/magneto/boards/editable");return t.map(s=>this.dataToResource({_id:s._id,title:s.title,icon:s.imageUrl,owner:s.ownerId,ownerName:s.ownerName,path:`/magneto#/board/${s._id}/view`,shared:!!(s.shared&&s.shared.length>=0),modified:""+s.modificationDate}))}}class MindmapBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","mindmap");l(this,"RESOURCE","mindmap")}async loadResources(){return(await this.httpGet("/mindmap/list/all")).map(s=>this.dataToResource({title:s.name,ownerName:s.owner.displayName,owner:s.owner.userId,icon:s.thumbnail||"/img/illustrations/mindmap-default.png",path:"/mindmap#/view/"+s._id,_id:s._id,shared:!!(s.shared&&s.shared.length>=0),modified:s.modified}))}}class PagesBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","pages");l(this,"RESOURCE","pages")}async loadResources(){const t=await this.httpGet("/pages/list/all"),s=[];return t.forEach(r=>{var o;const n=r.thumbnail?r.thumbnail+"?thumbnail=48x48":"/img/illustrations/pages.svg";s.push(this.dataToResource({title:r.title,owner:r.owner.userId,ownerName:r.owner.displayName,icon:n,path:"/pages#/website/"+r._id,_id:r._id,shared:typeof r.shared<"u",modified:r.modified})),(o=r.pages)==null||o.forEach(a=>{s.push(this.dataToResource({title:a.title,owner:r.owner.userId,ownerName:r.owner.displayName,icon:n,path:"/pages#/website/"+r._id+"/"+a.titleLink,_id:r._id+"/"+a.titleLink,shared:typeof r.shared<"u",modified:r.modified}))})}),s}}class PollBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","poll");l(this,"RESOURCE","poll")}async loadResources(){return(await this.httpGet("/poll/list/all")).map(s=>{const r=s.icon?s.icon+"?thumbnail=48x48":"/img/icons/glyphicons_036_file.png";return this.dataToResource({title:s.question,ownerName:s.owner.displayName,icon:r,path:"/poll#/view/"+s._id,_id:s._id,owner:s.owner.userId,shared:!!(s.shared&&s.shared.length>=0),modified:s.modified})})}}class ScrapbookBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","scrapbook");l(this,"RESOURCE","scrapbook")}async loadResources(){return(await this.httpGet("/scrapbook/list/all")).map(s=>{const r=s.icon||"/img/illustrations/scrapbook.svg";return this.dataToResource({title:s.name,owner:s.owner.userId,ownerName:s.owner.displayName,icon:r,path:"/scrapbook#/view-scrapbook/"+s._id,_id:s._id,shared:!!(s.shared&&s.shared.length>=0),modified:s.modified})})}}class TimelinegeneratorBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","timelinegenerator");l(this,"RESOURCE","timelinegenerator")}loadResources(){return new Promise(async(t,s)=>{try{const n=(await this.httpGet("/timelinegenerator/timelines")).map(o=>{const a=o.icon||"/img/illustrations/timeline-default.png";return this.dataToResource({title:o.headline,ownerName:o.owner.displayName,owner:o.owner.userId,icon:a,path:"/timelinegenerator#/view/"+o._id,_id:o._id,shared:typeof o.shared<"u",modified:o.modified})});t(n)}catch(r){s(r)}})}}class WikiBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","wiki");l(this,"RESOURCE","wiki")}async loadResources(){return(await this.httpGet("/wiki/listallpages")).map(s=>s.pages.map(r=>{let n;return typeof s.thumbnail>"u"||s.thumbnail===""?n="/img/icons/glyphicons_036_file.png":n=s.thumbnail+"?thumbnail=48x48",this.dataToResource({title:r.title+" ["+s.title+"]",ownerName:s.owner.displayName,owner:s.owner.userId,icon:n,path:"/wiki#/view/"+s._id+"/"+r._id,_id:`${s._id}#${r._id}`,shared:typeof s.shared<"u",modified:r.modified})})).flat()}}class WorkspaceBehaviour extends AbstractBehaviourService{constructor(){super(...arguments);l(this,"APP","workspace");l(this,"RESOURCE","workspace")}loadResources({search:t,asset_id:s}){return new Promise(async(r,n)=>{try{let o="/workspace/documents?filter=all&hierarchical=true";s&&s.length?o+=`&search=${t}`:t&&t.length&&(o+=`&search=${t}`);const h=(await this.httpGet(o)).filter(c=>!c.deleted).map(c=>{const u=c.metadata["content-type"]&&c.metadata["content-type"].indexOf("image")!==-1?`/workspace/document/${c._id}?thumbnail=120x120`:"/img/icons/unknown-large.png";return this.dataToResource({title:c.name,ownerName:c.ownerName,owner:c.owner,icon:u,path:`/workspace/document/${c._id}`,_id:c._id,shared:!!(c.shared&&c.shared.length>=0),modified:c.modified})});r(h)}catch(o){n(o)}})}}const C=class C{static async initialize(e,t){const s=e.http();return new Promise(r=>{this.resourceProducingApps.length?r(this.resourceProducingApps):(this.resourceProducingApps=[t,"workspace"],(async()=>{try{const[n,o]=await Promise.all([s.get("/resources-applications"),e.session().getUser()]);o&&o.apps&&(n!=null&&n.length)&&(this.resourceProducingApps=n.filter(a=>o.apps.some(h=>h.address.includes(a))))}catch{}r(this.resourceProducingApps)})())})}static async registerBehaviours(e){this.resourceProducingApps.forEach(t=>{const s={application:e,resourceType:t};this.registry.register(s,r=>this.serviceFor(r,e,t))})}static serviceFor(e,t,s){let r;switch(s){case"timelinegenerator":r=new TimelinegeneratorBehaviour(e);break;case"workspace":r=new WorkspaceBehaviour(e);break;case"blog":r=new BlogBehaviour(e);break;case"actualites":r=new ActualitesBehaviour(e);break;case"wiki":r=new WikiBehaviour(e);break;case"pages":r=new PagesBehaviour(e);break;case"poll":r=new PollBehaviour(e);break;case"community":r=new CommunityBehaviour(e);break;case"mindmap":r=new MindmapBehaviour(e);break;case"forum":r=new ForumBehaviour(e);break;case"homeworks":r=new HomeworksBehaviour(e);break;case"scrapbook":r=new ScrapbookBehaviour(e);break;case"collaborativewall":r=new CollaborativewallBehaviour(e);break;case"exercizer":r=new ExercizerBehaviour(e);break;case"formulaire":r=new FormulaireBehaviour(e);break;case"magneto":r=new MagnetoBehaviour(e);break;default:throw ERROR_CODE.NOT_SUPPORTED}return r.APP=t,r}};l(C,"registry",new ServiceRegistry),l(C,"findBehaviour",C.registry.findService.bind(C.registry)),l(C,"hasBehaviour",C.registry.isRegistered.bind(C.registry)),l(C,"resourceProducingApps",[]);let SnipletsService=C;const SEND_ALL="*";class WebBroker{constructor(e){l(this,"subscription");this.odeServices=e}get http(){return this.odeServices.http()}get events(){return this.odeServices.notify().events()}dispatchEvent(e,t){t.findIndex(r=>SEND_ALL===r||e.data["event-type"]===r)>=0&&this.http.post("/infra/event/web/store",e.data,{disableNotifications:!0})}initialize(e){if(e===void 0||e.send===void 0||e.send.length>0){const t=(e==null?void 0:e.send)??[SEND_ALL];this.subscription=this.events.subscribe(LAYER_NAME.WEB_DATA,s=>this.dispatchEvent(s,t))}return this}destroy(){this.subscription&&(this.subscription.revoke(),delete this.subscription)}}class DataService{constructor(e){l(this,"_webBroker");l(this,"app");l(this,"user");l(this,"profile");this.odeServices=e}get conf(){return this.odeServices.conf()}get notify(){return this.odeServices.notify()}async initialize(){try{const{app:e}=await this.notify.onAppConfReady().promise;this.app=e,this.user=await this.odeServices.session().getUser(),this.profile=await this.odeServices.session().getUserProfile();const{["data-service"]:t}=await this.conf.getPublicConf(e);this._webBroker=new WebBroker(this.odeServices).initialize(t==null?void 0:t.web)}catch{console.log("DataService not initialized, usage data unavailable.")}}predestroy(){this._webBroker&&(this._webBroker.destroy(),delete this._webBroker)}trackWebEvent(e){this.notify.events().publish(LAYER_NAME.WEB_DATA,{name:EVENT_NAME.DATA_TRACKED,data:e})}addUserInfos(e){return this.user&&(e.userId=this.user.userId,e.structure=this.user.structureNames[0]),this.profile&&(e.profil=this.profile[0]),e}trackVideoSave(e,t,s,r,n,o,a){const h=this.addUserInfos({"event-type":"VIDEO_SAVE",module:"video",video_id:e,browser:o,duration:Math.round(t),weight:s,source:r?"CAPTURED":"UPLOADED",url:n});this.app&&(h["override-module"]=this.app),a&&(h.device_type=a),this.trackWebEvent(h)}trackVideoRead(e,t,s,r,n){const o=this.addUserInfos({"event-type":"VIDEO_READ",module:"video",video_id:e,browser:r,source:t?"CAPTURED":"UPLOADED",url:s});this.app&&(o["override-module"]=this.app),n&&(o.device_type=n),this.trackWebEvent(o)}trackSpeechAndText(e){const t=this.addUserInfos({"event-type":"SPEECH_AND_TEXT",function:e});this.app&&(t.module=this.app),this.trackWebEvent(t)}trackAccessLibraryFromExplorer(){const e=this.addUserInfos({"event-type":"ACCESS_LIBRARY_FROM_EXPLORER"});this.app&&(e.module=this.app),this.trackWebEvent(e)}}class ReactionsService{constructor(e,t,s){this.context=e,this.module=t,this.resourceType=s}get http(){return this.context.http()}async loadAvailableReactions(){try{const{"reaction-types":e}=await this.context.conf().getPublicConf("audience");return Array.isArray(e)?e:void 0}catch{console.error("Audience configuration not found");return}}async loadReactionSummaries(e){const t=await this.http.get(`/audience/reactions/${this.module}/${this.resourceType}?resourceIds=${e.join(",")}`);return this.http.isResponseError()?{}:t.reactionsByResource}async loadReactionDetails(e,t,s){const r=await this.http.get(`/audience/reactions/${this.module}/${this.resourceType}/${e}?page=${t}&size=${s}`);return this.http.isResponseError()?void 0:r}async deleteReaction(e){await this.http.delete(`/audience/reactions/${this.module}/${this.resourceType}/${e}`)}async updateReaction(e,t){await this.http.putJson(`/audience/reactions/${this.module}/${this.resourceType}`,{resourceId:e,reactionType:t})}async createReaction(e,t){await this.http.postJson(`/audience/reactions/${this.module}/${this.resourceType}`,{resourceId:e,reactionType:t})}}class ViewsService{constructor(e,t,s){this.context=e,this.module=t,this.resourceType=s}get http(){return this.context.http()}async getCounters(e){const t=await this.http.get(`/audience/views/count/${this.module}/${this.resourceType}?resourceIds=${e.join(",")}`);return this.http.isResponseError()?{}:t}async getDetails(e){const t=await this.http.get(`/audience/views/details/${this.module}/${this.resourceType}/${e}`);return this.http.isResponseError()?void 0:t}trigger(e){return this.http.post(`/audience/views/${this.module}/${this.resourceType}/${e}`)}}class AudienceService{constructor(e,t,s){this.context=e,this.module=t,this.resourceType=s}get views(){return new ViewsService(this.context,this.module,this.resourceType)}get reactions(){return new ReactionsService(this.context,this.module,this.resourceType)}}class OdeServices{constructor(){l(this,"_analytics");l(this,"_cache");l(this,"_conf");l(this,"_data");l(this,"_directory");l(this,"_http");l(this,"_idiom");l(this,"_notify");l(this,"_rights");l(this,"_session");l(this,"_share");l(this,"_video");l(this,"_workspace");l(this,"_embedder");this._analytics=new AnalyticsService(this),this._cache=new CacheService(this),this._conf=new ConfService(this),this._data=new DataService(this),this._directory=new DirectoryService(this),this._http=new HttpService(this),this._idiom=new IdiomService(this),this._notify=NotifyFrameworkFactory.instance(),this._rights=new RightService(this),this._session=new SessionService(this),this._share=new ShareService(this),this._video=new VideoService(this),this._workspace=new WorkspaceService(this),this._embedder=new EmbedderService(this)}initialize(){return this._data.initialize(),this}analytics(){return this._analytics}audience(e,t){return new AudienceService(this,e,t)}cache(){return this._cache}conf(){return this._conf}data(){return this._data}directory(){return this._directory}http(){return this._http}idiom(){return this._idiom}notify(){return this._notify}resource(e,t){return t?ResourceService.findService({application:e,resourceType:t},this):ResourceService.findMainService({application:e},this)}behaviour(e,t){return SnipletsService.findBehaviour({application:e,resourceType:t},this)}rights(){return this._rights}session(){return this._session}share(){return this._share}video(){return this._video}workspace(){return this._workspace}embedder(){return this._embedder}}const ACTION={SEARCH:"search",CREATE:"create",CREATE_PUBLIC:"createPublic",OPEN:"open",EDIT:"edit",MANAGE:"manage",UPD_PROPS:"properties",COMMENT:"comment",DELETE:"delete",TRASH:"trash",RESTORE:"restore",MOVE:"move",COPY:"copy",EXPORT:"export",SHARE:"share",PRINT:"print",PAGES_LIST:"pages_list",DISTRIBUTE:"distribute",REGISTER:"register",PUBLISH:"publish",PUBLISH_MOODLE:"publish_moodle"},FOLDER={BIN:"bin",DEFAULT:"default"},BOOLEAN_FILTER={OWNER:"owner",SHARED:"shared",PUBLIC:"public",FAVORITE:"favorite"},SORT_ORDER={ASC:"asc",DESC:"desc"},SORT_BY={NAME:"name",MODIFY_DATE:"updatedAt",CREATED_AT:"createdAt",APPLICATION:"application",RESOURCE_TYPE:"resourceType"},odeServices=new OdeServices().initialize();class SessionFrameworkFactory{static instance(){return session}}const WIDGET_POSITION={LEFT:"left",RIGHT:"right"};class TransportFrameworkFactory{static instance(){return transport}}const firstLevelWidgets=["birthday","mood","calendar-widget","notes"],secondLevelWidgets=["agenda-widget","carnet-de-bord","my-apps","rss-widget","bookmark-widget","cursus-widget","maxicours-widget","school-widget"],defaultWidgetPosition={"last-infos-widget":WIDGET_POSITION.LEFT,birthday:WIDGET_POSITION.LEFT,"calendar-widget":WIDGET_POSITION.RIGHT,"carnet-de-bord":WIDGET_POSITION.LEFT,"record-me":WIDGET_POSITION.RIGHT,mood:WIDGET_POSITION.LEFT,"my-apps":WIDGET_POSITION.RIGHT,notes:WIDGET_POSITION.RIGHT,"rss-widget":WIDGET_POSITION.LEFT,"bookmark-widget":WIDGET_POSITION.RIGHT,qwant:WIDGET_POSITION.RIGHT,"qwant-junior":WIDGET_POSITION.LEFT,"agenda-widget":WIDGET_POSITION.LEFT,"cursus-widget":WIDGET_POSITION.LEFT,"maxicours-widget":WIDGET_POSITION.RIGHT,"universalis-widget":WIDGET_POSITION.RIGHT,"briefme-widget":WIDGET_POSITION.LEFT,"school-widget":WIDGET_POSITION.LEFT},defaultWidgetOrder={"school-widget":0,"my-apps":10,"record-me":15,"last-infos-widget":20,qwant:30,"qwant-junior":30,"universalis-widget":35,"agenda-widget":40,"bookmark-widget":50,"carnet-de-bord":60,"maxicours-widget":70,"cursus-widget":80,"briefme-widget":90,"rss-widget":100,mood:110,birthday:120,"calendar-widget":130,notes:140};class WidgetFramework{constructor(){l(this,"_initialized");l(this,"_widgets",[]);l(this,"_userPrefs",{})}initialize(e,t){return this._initialized||(this._initialized=new Promisified,notify.onSessionReady().promise.then(s=>{var r;s&&s.widgets?(s.widgets.forEach(n=>{this._widgets.push(new Widget(n))}),this.loadUserPrefs().then(()=>{var n;(n=this._initialized)==null||n.resolve()}).catch(n=>{var o;(o=this._initialized)==null||o.reject()})):(r=this._initialized)==null||r.reject()})),this._initialized.promise}get list(){return this._widgets}lookup(e){return this._widgets.find(t=>t.platformConf.name===e)}lookupDefaultPosition(e){return defaultWidgetPosition[e]}get userPrefs(){return this._userPrefs}async loadUserPrefs(){await configure.User.preferences.load("widgets",{}).then(e=>this.applyUserPrefs(e))}saveUserPrefs(){return configure.User.preferences.update("widgets",this._userPrefs).save("widgets").then(()=>{notify.events().publish(LAYER_NAME.WIDGETS,{name:EVENT_NAME.USERPREF_CHANGED})})}async applyUserPrefs(e){this._userPrefs=e??this._userPrefs;const t=configure.Platform.theme,s=[];t.listSkins().then(r=>{var a;const n=((a=r.find(h=>h.child===t.skin))==null?void 0:a.parent)==="panda"?secondLevelWidgets:firstLevelWidgets;this._widgets=this._widgets.filter((h,c)=>{const u=h.platformConf.name;return n.indexOf(u)!==-1?!1:(this._userPrefs[u]||(this._userPrefs[u]={index:defaultWidgetOrder[u]??999,show:!0,position:h.platformConf.position}),h.platformConf.mandatory&&(this._userPrefs[u].show=!0,this._userPrefs[u].index=defaultWidgetOrder[u]??999),h.platformConf.i18n&&s.push(h.platformConf.i18n),h.applyUserPref(this._userPrefs[u]),!0)});const o=new Idiom;this._widgets=this._widgets.sort((h,c)=>{const u=o.translate(`timeline.settings.${h.platformConf.name}`).toLowerCase(),d=o.translate(`timeline.settings.${c.platformConf.name}`).toLowerCase();return u<d?-1:u>d?1:0})})}}class Widget{constructor(e){l(this,"_schoolConf",{});l(this,"_userPref");this._platformConf=e,this._userPref=null}get platformConf(){return this._platformConf}get schoolConf(){return this._schoolConf}get userPref(){return this._userPref}applyUserPref(e){this._userPref=e,this._userPref.position=this._userPref.position??widgets.lookupDefaultPosition(this._platformConf.name)??"left"}}const widgets=new WidgetFramework;class LastInfosWidget{loadInfos(e){return transport.http.get("/actualites/infos/last/"+e)}getMaxResults(){return transport.http.get("/userbook/preference/maxInfos").then(e=>e.preference?parseInt(e.preference):4)}setMaxResults(e){return transport.http.putJson("/userbook/preference/maxInfos",`"${e}"`)}}const WIDGET_NAME={LAST_INFOS:"last-infos-widget",BIRTHDAY:"birthday",CALENDAR:"calendar-widget",CARNET:"carnet-de-bord",RECORD:"record-me",MOOD:"mood",MY_APPS:"my-apps",NOTES:"notes",RSS:"rss-widget",BOOKMARK:"bookmark-widget",QWANT:"qwant",QWANT_JUNIOR:"qwant-junior",AGENDA:"agenda-widget",CURSUS:"cursus-widget",MAXICOURS:"maxicours-widget",UNIVERSALIS:"universalis-widget",BRIEFME:"briefme-widget",SCHOOL:"school-widget"};class WidgetFrameworkFactory{static instance(){return widgets}}exports.ACTION=ACTION;exports.APP=APP$1;exports.BOOLEAN_FILTER=BOOLEAN_FILTER;exports.ConfigurationFrameworkFactory=ConfigurationFrameworkFactory;exports.DocumentHelper=DocumentHelper;exports.ERROR_CODE=ERROR_CODE;exports.EVENT_NAME=EVENT_NAME;exports.FOLDER=FOLDER;exports.ITimelineFactory=ITimelineFactory;exports.LAYER_NAME=LAYER_NAME;exports.LastInfosWidget=LastInfosWidget;exports.MimeTypeUtils=MimeTypeUtils;exports.NotifyFrameworkFactory=NotifyFrameworkFactory;exports.ReactionTypes=ReactionTypes;exports.ResourceService=ResourceService;exports.SORT_BY=SORT_BY;exports.SORT_ORDER=SORT_ORDER;exports.SessionFrameworkFactory=SessionFrameworkFactory;exports.SnipletsService=SnipletsService;exports.StringUtils=StringUtils;exports.TransportFrameworkFactory=TransportFrameworkFactory;exports.USER_PREFS=USER_PREFS;exports.WIDGET_NAME=WIDGET_NAME;exports.WIDGET_POSITION=WIDGET_POSITION;exports.WidgetFrameworkFactory=WidgetFrameworkFactory;exports.odeServices=odeServices;
