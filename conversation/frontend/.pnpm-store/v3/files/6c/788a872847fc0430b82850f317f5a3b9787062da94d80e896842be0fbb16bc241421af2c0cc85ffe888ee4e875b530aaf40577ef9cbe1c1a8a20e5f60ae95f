"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@tiptap/core"),e=require("@tiptap/pm/state"),i=require("@tiptap/pm/view");function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=o(require("katex"));const a=t=>{const{regex:o,katexOptions:a={}}=t;return new e.Plugin({key:new e.PluginKey("mathematics"),state:{init:()=>i.DecorationSet.empty,apply(t,e,n,s){const{selection:p}=s,c=[];return s.doc.descendants(((t,e)=>{if(t.isText&&t.text){let n;for(;n=o.exec(t.text);){const t=e+n.index,o=t+n[0].length,s=n[1];if(s){const e=p.$from.pos-p.$to.pos,n=p.$anchor.pos>=t&&p.$anchor.pos<=o,d=p.$from.pos>=t&&p.$to.pos<=o,u=0===e&&n||d;u||c.push(i.Decoration.widget(t,(()=>{const t=document.createElement("span");t.classList.add("Tiptap-mathematics-render");try{r.default.render(s,t,a)}catch(e){t.innerHTML=s}return t}))),c.push(i.Decoration.inline(t,o,{class:u?"Tiptap-mathematics-editor":"Tiptap-mathematics-editor Tiptap-mathematics-editor--hidden",style:u?void 0:"display: inline-block; height: 0; opacity: 0; overflow: hidden; position: absolute; width: 0;"}))}}}})),c.length>0?i.DecorationSet.create(s.doc,c):i.DecorationSet.empty}},props:{decorations(t){return this.getState(t)}}})},n=t.Extension.create({name:"Mathematics",addOptions:()=>({regex:/\$([^\$]*)\$/gi,katexOptions:void 0}),addProseMirrorPlugins(){return[a(this.options)]}});exports.Mathematics=n,exports.MathematicsPlugin=a,exports.default=n;
