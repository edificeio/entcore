<!--
 ~	Copyright © WebServices pour l'Éducation, 2014
 ~
 ~ This file is part of ENT Core. ENT Core is a versatile ENT engine based on the JVM.
 ~
 ~ This program is free software; you can redistribute it and/or modify
 ~ it under the terms of the GNU Affero General Public License as
 ~ published by the Free Software Foundation (version 3 of the License).
 ~
 ~ For the sake of explanation, any module that communicate over native
 ~ Web protocols, such as HTTP, with ENT Core is outside the scope of this
 ~ license and could be license under its own terms. This is merely considered
 ~ normal use of ENT Core, and does not fall under the heading of "covered work".
 ~
 ~ This program is distributed in the hope that it will be useful,
 ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
 ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 ~
 -->

 <h3 whereami class="twelve centered-text"></h3>

 <div class="spacer-large only-large-desktop"></div>
 <article class="flex-row f-column justify-center horizontal-margin only-desktop" ng-class='{ "divide-opacity": display.loading }'>
    <h3 ng-if="!display.editingFavorite"><i18n>directory.title.create.favorite</i18n></h3>
    <h3 ng-if="display.editingFavorite"><i18n>directory.title.edit.favorite</i18n></h3>
    <form class="reduce-block-eight horizontal-margin" ng-submit="saveFavorite()">
        <input type="text"
            ng-model="create.favorite.name"
            translate attr="placeholder"
            placeholder="directory.placeholder.title.favorite"
            class="text-flow twelve vertical-spacing-four"
            required ng-minlength="1"/>
        <div class="flex-row">
            <h4><i18n>directory.search.favorite</i18n></h4>
        </div>
        <div class="vertical-spacing-four">
            <div class="search-pagination flex-row vertical-spacing-four">
                <div class="cell six top-spacing-twice">
                    <input class="twelve" name="searchField" type="text" ng-model="create.favorite.search"
                        i18n-placeholder="directory.placeholder.search.example"
                        ng-keydown="$event.keyCode == 13 ? searchUsersAndGroups($event) : null"/>
                    <i class="search" ng-click="searchUsersAndGroups()"></i>
                </div>
                <div class="cell absolute-magnet">
                    <button type="button" ng-click="searchUsersAndGroups()" class="twelve">
                        <i18n>portal.search</i18n>
                    </button>
                </div>
            </div>
            <div class="flex-row medium-importance vertical-spacing-twice">
                <i18n>directory.filters</i18n>
                <div class="cell absolute-magnet">
                    <a ng-if="canFavoriteFormInitSearch()" class="vertical-spacing-four small-text" ng-click="favoriteFormInitSearch()">
                        <i18n>directory.init.search</i18n>
                    </a>
                </div>
            </div>
            <div class="flex-row">
                <multi-comboboxes ng-if="filtersOptions.users.structures.length > 1" class="twelve min-w-zero"
                    ng-model="create.favorite.filters.structures"
                    options="create.favorite.options.structures"
                    title-all="[[lang.translate('directory.allStructures')]]"
                    title="[[lang.translate('directory.structures')]]">
                </multi-comboboxes>
                <multi-comboboxes class="twelve min-w-zero" ng-class="{ 'horizontal-margin-twice': filtersOptions.users.structures.length > 1 }"
                    ng-model="create.favorite.filters.classes"
                    options="create.favorite.options.classes"
                    title-all="[[lang.translate('directory.allClasses')]]"
                    title="[[lang.translate('directory.classes')]]">
                </multi-comboboxes>
                <multi-comboboxes class="twelve min-w-zero" ng-class="{ 'horizontal-margin-twice': filtersOptions.users.structures.length < 2 }"
                    ng-model="create.favorite.filters.profiles"
                    options="create.favorite.options.profiles"
                    title-all="[[lang.translate('directory.allProfiles')]]"
                    title="[[lang.translate('directory.profiles')]]">
                </multi-comboboxes>
                <multi-comboboxes ng-if="filtersOptions.users.structures.length < 2" class="twelve min-w-zero"
                    ng-model="create.favorite.filters.functions"
                    options="create.favorite.options.functions"
                    title-all="[[lang.translate('directory.allFunctions')]]"
                    title="[[lang.translate('directory.functions')]]">
                </multi-comboboxes>
            </div>
            <div class="flex-row">
                <multi-comboboxes ng-if="filtersOptions.users.structures.length > 1" class="twelve min-w-zero"
                    ng-model="create.favorite.filters.functions"
                    options="create.favorite.options.functions"
                    title-all="[[lang.translate('directory.allFunctions')]]"
                    title="[[lang.translate('directory.functions')]]">
                </multi-comboboxes>
                <multi-comboboxes class="twelve min-w-zero" ng-class="{ 'horizontal-margin-twice': filtersOptions.users.structures.length > 1 }"
                    ng-model="create.favorite.filters.types"
                    options="create.favorite.options.types"
                    title-all="[[lang.translate('directory.allGroupsTypes')]]"
                    title="[[lang.translate('directory.groupsTypes')]]">
                </multi-comboboxes>
                <div ng-if="filtersOptions.users.structures.length < 2" class="twelve horizontal-margin-twice min-w-zero"></div>
                <div class="twelve min-w-zero"></div>
            </div>
        </div>
        <div class="row vertical-spacing-four">
            <div class="flex-row">
                <div class="six">
                    <h4><i18n>directory.search.favorite.add</i18n></h4>
                </div>
                <div class="six">
                    <h4><i18n>directory.composition.favorite</i18n></h4>
                </div>
            </div>
            <transfer-columns
                ng-model="create.favorite.members"
                searched-items="favoriteFormUsersGroups"
                loading="display.loadingFavoriteForm"
                text-right-warning-title = "[[lang.translate('directory.empty.favorite.composition.title')]]"
                text-right-warning-description = "[[lang.translate('directory.empty.favorite.composition.description')]]">
            </transfer-columns>
        </div>
        <div class="row vertical-spacing-four">
            <div class="right-magnet">
                <button type="button" class="flat-button" ng-click="tryRemoveFavorite(currentFavorite)" ng-if="display.editingFavorite">
                    <i18n>directory.deleteFavorite</i18n>
                </button>
                <button type="button" class="flat-button" ng-click="cancelFavorite()">
                    <i18n>cancel</i18n>
                </button>
                <button class="left-spacing" ng-disabled="create.favorite.members.length === 0">
                    <i18n>directory.save</i18n>
                </button>
            </div>
        </div>
    </form>

     <!-- Loading animation -->
    <div class="absolute-position-w centered-text" ng-if="display.loading">
        <img skin-src="/img/illustrations/loading.gif" width="100px" heigh="100px"/>
    </div>
 </article>