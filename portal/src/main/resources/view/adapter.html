<!doctype html>
<!--
 ~	Copyright © WebServices pour l'Éducation, 2014
 ~
 ~ This file is part of ENT Core. ENT Core is a versatile ENT engine based on the JVM.
 ~
 ~ This program is free software; you can redistribute it and/or modify
 ~ it under the terms of the GNU Affero General Public License as
 ~ published by the Free Software Foundation (version 3 of the License).
 ~
 ~ For the sake of explanation, any module that communicate over native
 ~ Web protocols, such as HTTP, with ENT Core is outside the scope of this
 ~ license and could be license under its own terms. This is merely considered
 ~ normal use of ENT Core, and does not fall under the heading of "covered work".
 ~
 ~ This program is distributed in the hope that it will be useful,
 ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
 ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 ~
 -->

<html>
<head>
	<script type="text/javascript">
		var appPrefix = '.';
		var eliotPrefix = '{{eliotPrefix}}';
	</script>
	<script src="{{#infra}}js/loader.js{{/infra}}" type="text/javascript" id="context"></script>
	<script type="text/javascript">
        (function () {
            window.addEventListener('DOMContentLoaded', () => {
                document.getElementsByTagName('body')[0].style.display = 'block'
            });

			function Message(action, content){
				this.action = action;
				this.content = content;
			}

			var actions = {
				'get-theme': function(){

				},
				'get-me': function(){
					var message = new Message('')
				}
			};

			window.addEventListener('message', function(e) {
				var message = e.data;
				actions[e.data.action](e.data.content);
			});
		}());
	</script>
</head>
<body style="height: 100%; width: 100%">
<iframe  id="adapter" class="adapter" style="z-index:500; position: absolute;height: 100%;width:100%"></iframe>
<portal>

</portal>
<script>
	if(window.location.href.split('#').length > 1){
		var appAddress = window.location.href.split('#')[1],
		regex = new RegExp(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi);
		if(appAddress.indexOf('?') !== -1){
			appAddress = appAddress;
		}
		else{
			appAddress = appAddress;
		}
		if (appAddress.match(regex)) {
			document.getElementById('adapter').setAttribute('src', appAddress);
		} else {
			window.location.href = "/welcome";
		}
	}
</script>
</body>
</html>
